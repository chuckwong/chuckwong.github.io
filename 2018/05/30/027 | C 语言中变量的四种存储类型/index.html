<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>C 语言中变量的四种存储类型 | 猫呆の屋 | Blog</title><meta name="keywords" content="auto,static,register,extern,全局变量,静态变量"><meta name="author" content="Junhao Wang"><meta name="copyright" content="Junhao Wang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="auto The auto and register specifiers give the declared objects automatic storage class, and may be used only within functions. Such declarations also serve as definitions and cause storage to be rese">
<meta property="og:type" content="article">
<meta property="og:title" content="C 语言中变量的四种存储类型">
<meta property="og:url" content="http://www.junhaow.com/2018/05/30/027%20|%20C%20%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B/index.html">
<meta property="og:site_name" content="猫呆の屋 | Blog">
<meta property="og:description" content="auto The auto and register specifiers give the declared objects automatic storage class, and may be used only within functions. Such declarations also serve as definitions and cause storage to be rese">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.junhaow.com/resources/banner/banner_1.jpg">
<meta property="article:published_time" content="2018-05-30T23:36:33.000Z">
<meta property="article:modified_time" content="2020-01-24T04:17:12.000Z">
<meta property="article:author" content="Junhao Wang">
<meta property="article:tag" content="auto">
<meta property="article:tag" content="static">
<meta property="article:tag" content="register">
<meta property="article:tag" content="extern">
<meta property="article:tag" content="全局变量">
<meta property="article:tag" content="静态变量">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.junhaow.com/resources/banner/banner_1.jpg"><link rel="shortcut icon" href="/resources/favicon/favicon.ico"><link rel="canonical" href="http://www.junhaow.com/2018/05/30/027%20|%20C%20%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-146643833-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-146643833-1');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '01/23/2020 20:17'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/resources/avatar/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">50</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">118</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/studynotes/"><i class="fa-fw fas fa-pencil-alt"></i><span> Study Notes</span></a></div><div class="menus_item"><a class="site-page" href="/lc/"><i class="fa-fw fas fa-list"></i><span> LeetCode Book</span></a></div><div class="menus_item"><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games I've Played</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-link"></i><span> Links</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://zhenf.dev"><i class="fa-fw fas fa-user"></i><span> Zhenf.dev</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.jianshu.com/u/41865efdad5d"><i class="fa-fw fas fa-user"></i><span> Xiaofu</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.davex.pw"><i class="fa-fw fas fa-user"></i><span> DaveX</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-grin-squint"></i><span> About Me</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/resources/banner/banner_1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">猫呆の屋 | Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/studynotes/"><i class="fa-fw fas fa-pencil-alt"></i><span> Study Notes</span></a></div><div class="menus_item"><a class="site-page" href="/lc/"><i class="fa-fw fas fa-list"></i><span> LeetCode Book</span></a></div><div class="menus_item"><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games I've Played</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-link"></i><span> Links</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://zhenf.dev"><i class="fa-fw fas fa-user"></i><span> Zhenf.dev</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.jianshu.com/u/41865efdad5d"><i class="fa-fw fas fa-user"></i><span> Xiaofu</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.davex.pw"><i class="fa-fw fas fa-user"></i><span> DaveX</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-grin-squint"></i><span> About Me</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">C 语言中变量的四种存储类型</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-05-30T23:36:33.000Z" title="Created 05/30/2018 16:36">05/30/2018</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-01-24T04:17:12.000Z" title="Updated 01/23/2020 20:17">01/23/2020</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">2.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>8min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="C 语言中变量的四种存储类型"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/auto/">auto</a><a class="post-meta__tags" href="/tags/static/">static</a><a class="post-meta__tags" href="/tags/register/">register</a><a class="post-meta__tags" href="/tags/extern/">extern</a><a class="post-meta__tags" href="/tags/%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/">全局变量</a><a class="post-meta__tags" href="/tags/%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F/">静态变量</a></div></div><article class="post-content" id="article-container"><h2 id="auto"><a href="#auto" class="headerlink" title="auto"></a>auto</h2><blockquote>
<p>The auto and register specifiers give the declared objects automatic storage class, and may be used <strong>only within functions</strong>. Such declarations also serve as definitions and cause storage to be reserved.</p>
</blockquote>
<p>也就是说动态分配和释放存储空间。当我们定义一个变量时，不给它初始值，它的值是不确定的。</p>
<p>我们之前编写程序的时候很少显式用到 auto 定义变量。<strong>如果定义的变量前面没有加static，编译系统会默认为是 auto 的存储方式</strong>，会把变量存放在动态存储区。</p>
<span id="more"></span>

<p>auto 修饰符的定义里有这么一句「进入包含变量声明的代码时，变量开始存在。当程序离开这个代码块时，变量<strong>自动</strong>消失。它所占用的内存可被用来做别的事情」。auto 修饰的变量是存储在堆栈中的，而全局变量存储在静态存储区中，所以我们不能用 auto 修饰全局变量。</p>
<p>auto 存储类型说明的变量都是<strong>局部于</strong>某个程序范围内的，只能在某个程序范围内使用，通常在函数体内或函数中的复合语句里。</p>
<p>如，有下述定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">int</span> k ;        <span class="comment">// 说明一个 auto 整型的 k 变量</span></span><br><span class="line"><span class="keyword">int</span> K ;             <span class="comment">// 省略了 auto，说明一个 auto 整型的 K 变量</span></span><br></pre></td></tr></table></figure>

<p>这两种定义方式是相同的，省略 auto 关键字也是我们常用的方式。</p>
<p><strong>注意：</strong>auto 只能用在函数体内，而不能用在全局变量中。</p>
<p>在 C 语言中使用 auto 定义的变量<strong>可以不予初始化</strong>，<strong>但在 C++ 中必须初始化</strong>。</p>
<p>此外，下面这种形式也是对的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> val;   <span class="comment">// 当省略数据类型，只使用 auto 修饰变量，在 C 语言中默认变量为 int 型（函数参数类型，返回值类型等等很多默认也是 int）</span></span><br></pre></td></tr></table></figure>

<h2 id="register"><a href="#register" class="headerlink" title="register"></a>register</h2><p>register 称为寄存器型，<strong>使用 register 关键词修饰变量的主要目的是想将所说明的变量放入寄存器存储空间中，我们知道寄存器数量有限，且位于 CPU 的内部，这样可以加快程序的运行速度。</strong>但正因为寄存器的资源相对较少，所以编译器会判断程序所指定的需要放在寄存器中的内容有没有必要放入寄存器中去，也就是说，编译器来决定是否将指定内容放入到寄存器中。如果没有必要放入寄存器中，就使用 auto 类型作处理。综上所述，register 是一个<strong>建议性</strong>关键字，编译器可以判断出是否去执行这样一个关键字，所以这个关键字在目前的用处不大。</p>
<p>例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> i，sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)</span><br><span class="line">    sum += i;</span><br></pre></td></tr></table></figure>

<h2 id="static"><a href="#static" class="headerlink" title="static"></a>static</h2><p>这个修饰符和 auto 相对，我们不能同时用<code>auto static int a = 10</code>。</p>
<p>static：称为静态存储类型，<strong>在 C 语言中，既可以在函数体内，也可在函数体外说明 static 存储类型的变量。</strong></p>
<p>在函数体内说明的 static 存储类型的变量也是一种局部变量，<strong>与 auto 最大不同点是：static 存储类型的变量在内存中是以固定地址存放的，而不是以堆栈方式存放的。</strong>只要整个程序还在继续运行，静态变量就不会随着程序段的结束而消失；static 修饰的变量只被初始化一次，且变量的值有继承性。</p>
<p>static 的作用有三条：</p>
<ul>
<li>第一个作用：<strong>隐藏</strong>，其他文件不可见</li>
<li>第二个作用：保持变量内容的<strong>持久</strong></li>
<li>第三个作用：默认<strong>初始化</strong>为 0</li>
</ul>
<p><strong>因此，static 的作用要区分全局（隐藏）和局部（保持持久）两种情况。</strong></p>
<h3 id="为什么是-0？"><a href="#为什么是-0？" class="headerlink" title="为什么是 0？"></a>为什么是 0？</h3><p>可参考：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/49111720">为什么在C语言中静态变量的初值是 0</a></p>
<blockquote>
<ol>
<li>不同的内存区域在程序运行时特性是不同，大致分为静态空间、栈空间、堆空间。静态空间其实是跟着程序映像一起加载到内存里的，提前就写在映像里了。无论如何都会有个初始值，反正写啥都是写，不如写 0；而栈空间和堆空间是映像加载完之后系统分配的，为了提高效率系统不会主动替你清零，C 也不会，所以未初始化的变量是内存里原有的值。简单来说，原因是效率。全局和静态变量是在编译期就确定了地址和值，并不消耗运行时的时间。局部变量是在每次函数调用时在栈上产生，你可以自行选择是否初始化。</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>很简单的问题，编译时没有赋值的全局变量会放在 bss 段。编译以后，bss 段是用来占位并且没有意义的。只有当程序加载运行时，虚拟存储器给 bss 段分配空间，在这段空间里请求二进制 0，程序加载时会对整个 bss 段进行清 0 操作，所以 C 语言没有赋值的全局变量是 0。</li>
</ol>
</blockquote>
<p>我觉得 2 比较靠谱，1 没有说到点子上。</p>
<h2 id="extern"><a href="#extern" class="headerlink" title="extern"></a>extern</h2><p>extern 称为外部参照引用型，使用 extern 修饰的变量是想引用在<strong>其它文件中或在函数体外部</strong>已经声明的变量。</p>
<p>如下面的程序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a = %d\n&quot;</span> , a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该程序可以成功运行，输出 a 的值为 1，而如果改变一下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a = %d\n&quot;</span> , a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>这样在进行编译时，编译器会报错，提示变量 a 没有被定义，也就是说<strong>全局变量的作用范围是从定义处开始直至程序结束</strong>。现在，我们在该程序的基础上加上一句声明：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a; <span class="comment">// 注意不加类型 int 会出 warning</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a = %d\n&quot;</span>, a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>在编译时，即使后面没有 a 的定义，也不会报错，链接时才报错。</p>
<p>在这里要注意 extern 关键字对于变量的类型说明可以省略，但对于变量的类型及值是<strong>没有任何改变权限的</strong>，也就是说在上面例子中的 extern 如果写成 extern float a; 或者是 extern int a = 3; 编译时会提示错误。</p>
<p><strong>extern 扩大了外部变量的作用范围。</strong></p>
<p>我们知道头文件只要是存放函数和变量声明的，所以用 extern 声明的变量也尽量写在头文件中，如果写在 <code>.cpp</code>或者<code>.c</code>文件中容易埋下苦果。</p>
<h3 id="如何在两个文件中访问同一个全局变量"><a href="#如何在两个文件中访问同一个全局变量" class="headerlink" title="如何在两个文件中访问同一个全局变量"></a>如何在两个文件中访问同一个全局变量</h3><p>方法一：不使用头文件</p>
<ol>
<li><code>a.c</code>中<code>int foo;</code></li>
<li><code>b.c</code>中<code>extern int foo;</code></li>
</ol>
<p>方法二：使用头文件（推荐，即不在<code>.c</code>或<code>.cpp</code>文件中使用 extern）</p>
<ol>
<li><code>a.h</code>中<code>extern int foo;</code>（注意如果不加 extern 可能会重复定义，发生冲突）</li>
<li><code>a.c</code>中定义<code>int foo;</code>不必添加<code>#include &quot;a.h&quot;</code></li>
<li><code>b.c</code>中没有定义（也不能重复定义吧），需要添加<code>#include &quot;a.h&quot;</code>（推荐）或者在代码中添加<code>extern int foo;</code>（不推荐）</li>
</ol>
<h2 id="全局变量与静态全局变量"><a href="#全局变量与静态全局变量" class="headerlink" title="全局变量与静态全局变量"></a>全局变量与静态全局变量</h2><p>全局与局部对应。与静态 static 相对的是动态 auto 变量，如函数体内用 auto 修饰的变量，动态的意思体现在函数对变量内存空间的分配和释放上，是在函数调用和结束的时候进行的。</p>
<p>全局变量是不用 static 修饰的全局变量。<strong>我这里也很懵逼！在 C 语言中，全局变量本身是静态存储的，为什么还叫静态全局变量？我觉得叫 static 全局变量比较好。</strong></p>
<p>静态全局变量是显式用 static 修饰的全局变量，作用域是声明此变量所在的文件，其他的文件即使用 extern 声明也不能使用。</p>
<p>当程序由一个源文件构成时，全局变量与静态全局变量没有区别；当程序由多个源文件构成时，全局变量与静态静态变量不同。</p>
<p>静态全局变量的作用：</p>
<ol>
<li>不必担心其它源文件使用相同变量名，彼此相互独立；</li>
<li>在某源文件中定义的静态全局变量不能被其他源文件使用或修改；</li>
<li>只能在本文件中使用。具有内部链接的静态性，不允许在其他文件里调用。</li>
</ol>
<p>总的来说，把局部变量改变为静态变量后是改变了它的存储方式和生存期，而把全局变量改变为静态变量后是改变了它的作用域，限制了它的使用范围。因此 static 这个说明符在不同的地方所起的作用是不同的。为什么当初不设计成 file 关键字呢？表示该变量的作用域是文件。</p>
<p>Tips：</p>
<p><strong>（下面这几句话值得记住）</strong></p>
<ol>
<li><p>若全局变量仅在<strong>单个 C 文件</strong>中访问，则可以将这个变量修改为静态全局变量，以降低模块间的耦合度；</p>
</li>
<li><p>若全局变量仅由<strong>单个函数</strong>访问，则可以将这个变量改为该函数的静态局部变量，以降低模块间的耦合度；</p>
</li>
<li><p>如果我们需要一个可重入的函数，那么，我们一定要避免函数中使用 static 变量（这样的函数被称为：带「内部存储器」功能的的函数）；</p>
</li>
<li><p>函数中必须要使用 static 变量的情况：当某函数的<strong>返回值为指针类型</strong>时，则必须是 static 的局部变量的地址作为返回值；若为 auto 类型，则返回为错误的指针（返回是值复制）。举个例子：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> *<span class="title">foo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> *p1 = &amp;a; <span class="comment">// a 是局部变量，返回了 a 变量的地址</span></span><br><span class="line">    <span class="keyword">return</span> p1;    <span class="comment">// 所以外部再次访问的时候是随机值，但没 warning</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">foo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p2 = <span class="string">&quot;hahah&quot;</span>;  <span class="comment">// 字符存储在常量区，这种情况不需要 static</span></span><br><span class="line">    <span class="keyword">return</span> p2;    <span class="comment">// 打印 hahah</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">foo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> p3[] = <span class="string">&quot;hahahhahah&quot;</span>;  <span class="comment">// 字符存储在栈，并非常量</span></span><br><span class="line">    <span class="keyword">return</span> p3;    <span class="comment">// 产生 warning，说返回了栈地址</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *p = foo1();</span><br><span class="line">    <span class="keyword">char</span> *pp = foo2();</span><br><span class="line">    <span class="keyword">char</span> *ppp = foo3();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, pp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, ppp);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 输出：</p>
 <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a.c:<span class="number">56</span>:<span class="number">12</span>: <span class="built_in">warning</span>: address <span class="keyword">of</span> stack memory associated <span class="keyword">with</span> <span class="keyword">local</span> variable <span class="string">&#x27;p3&#x27;</span> returned [-Wreturn-stack-address]</span><br><span class="line">    <span class="keyword">return</span> p3;</span><br><span class="line">           ^~</span><br><span class="line"><span class="number">1</span> <span class="built_in">warning</span> <span class="keyword">generated</span>.</span><br><span class="line"><span class="number">-2027492106</span></span><br><span class="line">hahah</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>参考的链接已在对应的标题下，大部分链接忘了记录，以后要记下来。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Junhao Wang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://www.junhaow.com/2018/05/30/027%20|%20C%20%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B/">http://www.junhaow.com/2018/05/30/027%20|%20C%20%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post_share"><div class="social-share" data-image="/resources/banner/banner_1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2018/06/17/029 | C 语言全局变量初始化和符号重名的问题/" title="C 语言全局变量初始化和符号重名的问题"><img class="cover" src="/resources/banner/banner_1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 06/17/2018</div><div class="title">C 语言全局变量初始化和符号重名的问题</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#auto"><span class="toc-number">1.</span> <span class="toc-text">auto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#register"><span class="toc-number">2.</span> <span class="toc-text">register</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#static"><span class="toc-number">3.</span> <span class="toc-text">static</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF-0%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">为什么是 0？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extern"><span class="toc-number">4.</span> <span class="toc-text">extern</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AE%BF%E9%97%AE%E5%90%8C%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">4.1.</span> <span class="toc-text">如何在两个文件中访问同一个全局变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E4%B8%8E%E9%9D%99%E6%80%81%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">5.</span> <span class="toc-text">全局变量与静态全局变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2021 By Junhao Wang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">return 0;</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://www.junhaow.com/2018/05/30/027%20|%20C%20%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E5%9B%9B%E7%A7%8D%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B/'
    this.page.identifier = '2018/05/30/027 | C 语言中变量的四种存储类型/'
    this.page.title = 'C 语言中变量的四种存储类型'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://junhaow.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>