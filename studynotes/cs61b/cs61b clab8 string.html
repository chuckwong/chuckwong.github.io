<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:300,300italic,400,400italic,700,700italic|Bitter:300,300italic,400,400italic,700,700italic|Menlo:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.junhaow.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Challenge Lab 8: linkCode: linkReference: Wikipedia Brute-force Substring Matching1234567891011&#x2F;&#x2F; string: helloworld&#x2F;&#x2F; pattern: owo&#x2F;&#x2F; n &#x3D; 10, m &#x3D; 3function NaiveSearch(string s[1..n], string pattern">
<meta property="og:type" content="website">
<meta property="og:title" content="CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)">
<meta property="og:url" content="http://www.junhaow.com/studynotes/cs61b/cs61b%20clab8%20string.html">
<meta property="og:site_name" content="B_L_OO_GGG">
<meta property="og:description" content="Challenge Lab 8: linkCode: linkReference: Wikipedia Brute-force Substring Matching1234567891011&#x2F;&#x2F; string: helloworld&#x2F;&#x2F; pattern: owo&#x2F;&#x2F; n &#x3D; 10, m &#x3D; 3function NaiveSearch(string s[1..n], string pattern">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/vmqyw.png">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/a4y7d.png">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/46wcq.png">
<meta property="article:published_time" content="2020-04-17T20:45:12.591Z">
<meta property="article:modified_time" content="2019-10-15T07:21:39.000Z">
<meta property="article:author" content="Junhao Wang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/vmqyw.png">

<link rel="canonical" href="http://www.junhaow.com/studynotes/cs61b/cs61b%20clab8%20string">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm) | B_L_OO_GGG
</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146643833-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-146643833-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">B_L_OO_GGG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Sumomo mo momo mo no uchi</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-inbox fa-fw"></i>Archives<span class="badge">50</span></a>

  </li>
        <li class="menu-item menu-item-studynotes">

    <a href="/studynotes/" rel="section"><i class="fa fa-pencil-alt fa-fw"></i>Study Notes</a>

  </li>
        <li class="menu-item menu-item-lc">

    <a href="/lc/" rel="section"><i class="fa fa-th fa-fw"></i>LeetCode Book</a>

  </li>
        <li class="menu-item menu-item-games">

    <a href="/games/" rel="section"><i class="fa fa-gamepad fa-fw"></i>Games I've Played</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-grin-squint fa-fw"></i>About Me</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content page posts-expand">
            

    
    
    
    <div class="post-block" lang="en">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)
</h1>

<div class="post-meta">
  
  <ul class="breadcrumb">
          
            <li><a href="/studynotes/">STUDYNOTES</a></li>
            <li><a href="/studynotes/cs61b/">CS61B</a></li>
            <li>CS61B CLAB8 STRING</li>
          
  </ul>

</div>

</header>

      
      
      
      <div class="post-body">
          <br>

<p>Challenge Lab 8: <a target="_blank" rel="noopener" href="https://sp19.datastructur.es/materials/clab/clab8/clab8">link</a><br>Code: <a target="_blank" rel="noopener" href="https://github.com/junhaowww/cs61b-sp18/tree/master/clab8">link</a><br>Reference: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rabin%E2%80%93Karp_algorithm">Wikipedia</a></p>
<h2 id="Brute-force-Substring-Matching"><a href="#Brute-force-Substring-Matching" class="headerlink" title="Brute-force Substring Matching"></a>Brute-force Substring Matching</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string: helloworld</span></span><br><span class="line"><span class="comment">// pattern: owo</span></span><br><span class="line"><span class="comment">// n = 10, m = 3</span></span><br><span class="line"><span class="function">function <span class="title">NaiveSearch</span><span class="params">(string s[<span class="number">1.</span>.n], string pattern[<span class="number">1.</span>.m])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> i from <span class="number">1</span> to n-m+<span class="number">1</span>: <span class="comment">// n-m+1 ~ n</span></span><br><span class="line">    <span class="keyword">for</span> j from <span class="number">1</span> to m: <span class="comment">// m</span></span><br><span class="line">      <span class="keyword">if</span> s[i+j-<span class="number">1</span>] != pattern[j]:</span><br><span class="line">        jump to next iteration of outer loop</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> not found</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This algorithm works well in many practical cases, but can exhibit relatively <code>long running times</code> in certain examples, such as searching for a pattern string of 10,000 “a”s followed by a single “b” in a search string of 10 million “a”s, in which case it exhibits its worst-case $O(nm)$ time.</p>
<ul>
<li>The <code>Knuth-Morris-Pratt algorithm</code> reduces this to $O(n)$ using pre-computation to examine each text character only once. (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm">wiki link (nice explanation)</a>)</li>
<li>The <code>Boyer-Moore algorithm</code> skips forward not by 1 character, but by as many as possible for the search to succeed. It focuses on the outer loop.</li>
</ul>
<p>The Rabin-Karp algorithm focuses on the inner loop.</p>
<h2 id="Rabin-Karp-algorithm"><a href="#Rabin-Karp-algorithm" class="headerlink" title="Rabin-Karp algorithm"></a>Rabin-Karp algorithm</h2><p>This algorithm uses hashing to find any one of a set of pattern strings a text. For text of length $n$ and $p$ patterns of combined length $m$, its average and best case running time is $O(n + m)$ in space $O(p)$, but its worst-case time is $O(nm)$.</p>
<p>In contrast, the <code>Aho–Corasick string-matching algorithm</code> has asymptotic worst-time complexity $O(n+m)$ in space $O(m)$.</p>
<p>A practical application of the algorithm is <code>detecting plagiarism</code>.</p>
<h3 id="Use-hashing-for-shifting-substring-search"><a href="#Use-hashing-for-shifting-substring-search" class="headerlink" title="Use hashing for shifting substring search"></a>Use hashing for shifting substring search</h3><p>Rather than pursuing more sophisticated <code>skipping</code>, the Rabin–Karp algorithm seeks to <code>speed up the testing of equality</code> of the pattern to the substrings in the text by using a <code>hash function</code>.</p>
<p>The algorithm exploits the fact that if two strings are equal, their hash values are also equal. Thus, string matching is reduced (almost) to computing the hash value of the search pattern and then looking for substrings of the input string with that hash value.</p>
<p>One problem is that because there are so many different strings and so few hash values, <code>some differing strings will have the same hash value</code>. If the hash values match, the pattern and the substring may not match; consequently, the potential match of search pattern and the substring must be confirmed by comparing them; that comparison can take a long time for long substrings.</p>
<p>Luckily, a <code>good hash function</code> on reasonable strings usually does not have many collisions, so the expected search time will be acceptable.</p>
<p><strong>The algorithm is as shown:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">RabinKarp</span><span class="params">(string s[<span class="number">1.</span>.n], string pattern[<span class="number">1.</span>.m])</span> </span>&#123;</span><br><span class="line">  patternHash := hash(pattern[<span class="number">1.</span>.m]);  <span class="comment">// A: O(m)</span></span><br><span class="line">  <span class="keyword">for</span> i from <span class="number">1</span> to n-m+<span class="number">1</span>:   <span class="comment">// ~ n times</span></span><br><span class="line">    stringHash := hash(s[i..i+m-<span class="number">1</span>])    <span class="comment">// B: O(m)</span></span><br><span class="line">    <span class="keyword">if</span> patternHash = stringHash:       <span class="comment">// C: O(n) C determines whether D is executed</span></span><br><span class="line">      <span class="keyword">if</span> s[i..i+m-<span class="number">1</span>] = pattern[<span class="number">1.</span>.m]:  <span class="comment">// D: O(m)</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> not found</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Runtime analysis:</strong></p>
<p>Naively <code>computing the hash value</code> for an m-length string requires $O(m)$ time because each character is examined.</p>
<p>Lines A, B, and D each require $O(m)$ time. However, Line A is only executed once, and Line D is only executed if the hash values match, which is unlikely to happen more than a few times.</p>
<p>Line C is executed $O(n)$ times, but each comparison only requires constant time, so its impact is $O(n)$. The issue is Line B: <code>stringHash := hash(s[i..i+m-1])</code></p>
<p>So, with the naive method of computing the hash value of the substring on each loop, the algorithm requires $O(nm)$ time, the same complexity as the aforementioned brute-force method.</p>
<p><strong>Rolling Hash</strong></p>
<p>For speed, the hash must be computed in constant time. The trick is the variable <code>stringHash</code> already contains the previous hash value of <code>s[i..i+m-1]</code>. If that value can be used to compute the next hash value in constant time, then computing successive hash values will be fast.</p>
<p>The trick can be exploited using a <code>rolling hash</code>. A rolling hash is a hash function specially designed to enable this operation. A trivial (but not very good) rolling hash function just adds the values of each character in the substring. This rolling hash formula can compute the next hash value from the previous value in constant time:</p>
<p><code>s[i+1..i+m] = s[i..i+m-1] - s[i] + s[i+m]</code></p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/vmqyw.png"></p>
<p>But this hashing method like other poor hash methods will result in poor performance in Line C (<code>if patternHash = stringHash:</code>) and it would be executed $O(n)$ times. And the following character-by-character comparison of strings with length $m$ takes $O(m)$ time, the whole algorithm then takes a worst-case $O(nm)$ time.</p>
<h3 id="Rabin-fingerprint"><a href="#Rabin-fingerprint" class="headerlink" title="Rabin fingerprint"></a>Rabin fingerprint</h3><p>The key to the Rabin–Karp algorithm’s performance is the efficient computation of hash values of the successive substrings of the text. The <code>Rabin fingerprint</code> is a popular and effective rolling hash function. </p>
<p>The hash function described here is not a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rabin_fingerprint">Rabin fingerprint</a>, but it works equally well. It treats every substring as a number in some <code>base</code>, the base being usually the size of the character set.</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/a4y7d.png" title="Wikipedia: Rabin fingerprint"></p>
<p>For example, if the substring is “hi”, the base is <code>256</code>, and prime modules is <code>101</code>, then the hash value would be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;h&#39; &#x3D; 104</span><br><span class="line">&#39;i&#39; &#x3D; 105</span><br><span class="line">[ ( 104 x 256 ) % 101 + 105 ] % 101 &#x3D; 65</span><br></pre></td></tr></table></figure>

<p>For example (hash rolling), if we have text “abracadabra” and we are searching for a pattern of length 3, the hash of the first substring “abr”, using <code>256</code> as the base and <code>101</code> as the prime modulus is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#39;a&#39; &#x3D; 97</span><br><span class="line">&#39;b&#39; &#x3D; 98</span><br><span class="line">&#39;r&#39; &#x3D; 114</span><br><span class="line">1st: (97 x 256) % 101</span><br><span class="line">2nd: ( (97 x 256) % 101 x 256 + 98 ) % 101</span><br><span class="line">3rd: [ ( ( (97 x 256) % 101 x 256 + 98 ) % 101 ) x 256 + 114 ] % 101</span><br><span class="line">hash(&quot;abr&quot;) &#x3D; [( ( (97 x 256) % 101 x 256 + 98 ) % 101 ) x 256 + 114 ] % 101</span><br><span class="line">            &#x3D; (97 x 256^2 + 98 x 256 + 114) % 101</span><br><span class="line">            &#x3D; (52 + 40 + 114) % 101</span><br><span class="line">            &#x3D; (92 + 114) % 101 &#x3D; 206 % 101 &#x3D; 4</span><br><span class="line">            or &#x3D; ((52 % 101) + (40 % 101) + (114 % 101)) % 101 &#x3D; 4</span><br></pre></td></tr></table></figure>

<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/46wcq.png"></p>
<p>$$ (x + y) \bmod{z} = \left[ x \bmod{z} + y \bmod{z} \right] \bmod{z} $$<br>$$ (x \times y) \bmod{z} = \left[(x \bmod{z}) \times (y\bmod{z})\right] \bmod{z} $$</p>
<p>Then we compute the hash of the next substring, “bra”, from the hash “abr” by <code>subtracting</code> the number added for the first ‘a’, i.e. $97 \times 256^2$, multiplying by the base and adding for the last ‘a’ of “bra”, i.e. $97 \times 256^0$.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hash(&quot;abr&quot;) &#x3D; (97 x 256^2 + 98  x 256 + 114) % 101</span><br><span class="line">hash(&quot;bra&quot;) &#x3D; (98 x 256^2 + 114 x 256 + 97)  % 101</span><br><span class="line">&#x2F;&#x2F; How can we compute hash(&quot;bra&quot;) from hash(&quot;abr&quot;)?</span><br><span class="line">hash(&quot;bra&quot;) &#x3D; [(hash(&quot;abr&quot;) - 1st Term) x 256 + New Term] % 101</span><br><span class="line">            &#x3D; [(hash(&quot;abr&quot;) - 97 x 256^2) x 256 + 97] % 101</span><br></pre></td></tr></table></figure>

<p>Although <code>((256 % 101) x 256) % 101</code> is the same as <code>256^2 % 101</code>, to avoid <code>overflowing</code> integer maximums when the pattern string is longer (e.g. ‘Rabin-Karp’ is 10 characters, <code>256^9</code> is the offset without modulation), the pattern length base offset is pre-calculated in a loop, modulating the result each iteration.</p>
<p>If the substrings in question are long, this algorithm achieves great savings compared with many other hashing schemes.</p>
<h3 id="Multiple-pattern-search"><a href="#Multiple-pattern-search" class="headerlink" title="Multiple pattern search"></a>Multiple pattern search</h3><p>The Rabin-Karp algorithm is an algorithm of choice for multiple pattern search.</p>
<p>To find any of a large number, say $k$, fixed length patterns in a text, a simple variant of the algorithm uses a <code>Bloom filter</code> or a <code>set data structure</code> to check whether the hash of a given string belongs to a set of hash values of patterns we are looking for:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">RabinKarpSet</span><span class="params">(string s[<span class="number">1.</span>.n], set of string subs, m)</span>:</span></span><br><span class="line"><span class="function">  set hsubs :</span>= emptySet</span><br><span class="line">  foreach sub in subs:</span><br><span class="line">    <span class="function">insert <span class="title">hash</span><span class="params">(sub[<span class="number">1.</span>.m] into hsubs)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">for</span> i from 1 to n-m+1:</span></span><br><span class="line"><span class="function">    hs :</span>= hash(s[i+<span class="number">1.</span>.i+m])</span><br><span class="line">    <span class="keyword">if</span> hs in hsubs and s[i..i+m-<span class="number">1</span>] in subs:</span><br><span class="line">      <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> not found</span><br></pre></td></tr></table></figure>

<p>We assume all the substrings have a fixed length $m$.</p>
<p>A naïve way to search for $k$ patterns is to repeat a single-pattern search taking $O(n+m)$ time, totaling in $O((n+m)k)$ time. In contrast, the above algorithm above can find all k patterns in $O(n+km)$ expected time, assuming that a hash table check works in $O(1)$ expected time. A deterministic $O(n+km)$ solution is the <code>Aho–Corasick algorithm</code>.</p>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p><a target="_blank" rel="noopener" href="https://github.com/junhaowww/cs61b-sp18/blob/master/clab8/RollingString.java">RollingString.java</a><br><a target="_blank" rel="noopener" href="https://github.com/junhaowww/cs61b-sp18/blob/master/clab8/RabinKarpAlgorithm.java">RabinKarpAlgorithm.java</a></p>
<h2 id="KMP-Implementation"><a href="#KMP-Implementation" class="headerlink" title="KMP Implementation"></a>KMP Implementation</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KMP</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//           1         2</span></span><br><span class="line">  <span class="comment">// m: 01234567890123456789012</span></span><br><span class="line">  <span class="comment">// S: ABC ABCDAB ABCDABCDABDE</span></span><br><span class="line">  <span class="comment">// W:     ABCDABD</span></span><br><span class="line">  <span class="comment">// i:     0123456</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ABC ABCD AB EF ABCD GGG (input)</span></span><br><span class="line">  <span class="comment">//     ABCD AB EF ABCD EEE (pattern)</span></span><br><span class="line">  <span class="comment">//     0123 45 67 8901 234</span></span><br><span class="line">  <span class="comment">//          AB vs ABCD</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmp</span><span class="params">(String input, String pattern)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = input.length();    <span class="comment">// 0 1 2 3 4 (n = 5, m = 3)</span></span><br><span class="line">    <span class="keyword">int</span> m = pattern.length();  <span class="comment">// A B C</span></span><br><span class="line">    <span class="keyword">if</span> (m &gt; n) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> inputOffset = <span class="number">0</span>;       <span class="comment">// potential input jump</span></span><br><span class="line">    <span class="keyword">int</span> patternOffset = <span class="number">0</span>;     <span class="comment">// potential starting pattern offset</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - m + <span class="number">1</span>; ) &#123;</span><br><span class="line">      inputOffset = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = patternOffset; j &lt; m; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == patternOffset) patternOffset = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> currentPos = i + j;  <span class="comment">// current position of input string</span></span><br><span class="line">        <span class="comment">// equal - match or move on and record potential</span></span><br><span class="line">        <span class="keyword">if</span> (input.charAt(currentPos) == pattern.charAt(j)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (j == m - <span class="number">1</span>) <span class="keyword">return</span> i;  <span class="comment">// match and return</span></span><br><span class="line">          <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;  <span class="comment">// if j == 0 -&gt; first time -&gt; don&#x27;t record</span></span><br><span class="line">            <span class="keyword">if</span> (input.charAt(currentPos) == pattern.charAt(patternOffset)) &#123;</span><br><span class="line">              inputOffset = (inputOffset == <span class="number">0</span>) ? currentPos : inputOffset;</span><br><span class="line">              patternOffset += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              inputOffset = <span class="number">0</span>;    <span class="comment">// reset</span></span><br><span class="line">              patternOffset = <span class="number">0</span>;  <span class="comment">// reset</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// not equal - should stop</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (inputOffset == <span class="number">0</span> &amp;&amp; patternOffset == <span class="number">0</span>) &#123; <span class="comment">// jump to the farthest</span></span><br><span class="line">            i = (j &gt; <span class="number">0</span>) ? currentPos : currentPos + <span class="number">1</span>;    <span class="comment">// if stop initially</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123; <span class="comment">// jump to the potential matching position</span></span><br><span class="line">            i = inputOffset;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;  <span class="comment">// back to outer loop</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// test</span></span><br><span class="line">    String input = <span class="string">&quot;ABC ABCDAB ABCDABCDABDE&quot;</span>;</span><br><span class="line">    String pattern = <span class="string">&quot;ABCDABD&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> result = kmp(input, pattern);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      </div>
      
      
      
    </div>
    
  <ul class="breadcrumb">
          
            <li><a href="/studynotes/">STUDYNOTES</a></li>
            <li><a href="/studynotes/cs61b/">CS61B</a></li>
            <li>CS61B CLAB8 STRING</li>
          
  </ul>

    
    
    


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Brute-force-Substring-Matching"><span class="nav-number">1.</span> <span class="nav-text">Brute-force Substring Matching</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rabin-Karp-algorithm"><span class="nav-number">2.</span> <span class="nav-text">Rabin-Karp algorithm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-hashing-for-shifting-substring-search"><span class="nav-number">2.1.</span> <span class="nav-text">Use hashing for shifting substring search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rabin-fingerprint"><span class="nav-number">2.2.</span> <span class="nav-text">Rabin fingerprint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-pattern-search"><span class="nav-number">2.3.</span> <span class="nav-text">Multiple pattern search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation"><span class="nav-number">2.4.</span> <span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KMP-Implementation"><span class="nav-number">3.</span> <span class="nav-text">KMP Implementation</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Junhao Wang"
      src="/images/cat_with_glasses.jpg">
  <p class="site-author-name" itemprop="name">Junhao Wang</p>
  <div class="site-description" itemprop="description">Debug the old world, bug the new world!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://twitter.com/junhaowww" title="Twitter → https://twitter.com/junhaowww" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/junhaowww" title="GitHub → https://github.com/junhaowww" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/junhaowww/" title="LinkedIn → https://www.linkedin.com/in/junhaowww/" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.douban.com/people/maodai/" title="豆瓣 (Book) → https://www.douban.com/people/maodai/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>豆瓣 (Book)</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/41865efdad5d/" title="https://www.jianshu.com/u/41865efdad5d/" rel="noopener" target="_blank">Xiaofud</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.davex.pw/" title="https://www.davex.pw/" rel="noopener" target="_blank">DaveX</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://" title="http://" rel="noopener" target="_blank">alexfan.xyz</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Junhao Wang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://junhaow.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://www.junhaow.com/studynotes/cs61b/cs61b%20clab8%20string.html";
    this.page.identifier = "studynotes/cs61b/cs61b clab8 string.html";
    this.page.title = "CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://junhaow.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
