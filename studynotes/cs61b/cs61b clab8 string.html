<!DOCTYPE html>




<html class="theme-next pisces" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,300italic,400,400italic,700,700italic|Bitter:300,300italic,400,400italic,700,700italic|Bitter:300,300italic,400,400italic,700,700italic|Menlo:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="junhaow, maodai">










<meta name="description" content="Challenge Lab 8: linkCode: linkReference: Wikipedia Brute-force Substring Matching1234567891011// string: helloworld// pattern: owo// n = 10, m = 3function NaiveSearch(string s[1..n], string pattern[">
<meta property="og:type" content="website">
<meta property="og:title" content="CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)">
<meta property="og:url" content="http://www.junhaow.com/studynotes/cs61b/cs61b clab8 string.html">
<meta property="og:site_name" content="B_L_OO_GGG">
<meta property="og:description" content="Challenge Lab 8: linkCode: linkReference: Wikipedia Brute-force Substring Matching1234567891011// string: helloworld// pattern: owo// n = 10, m = 3function NaiveSearch(string s[1..n], string pattern[">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/vmqyw.png">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/a4y7d.png">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/46wcq.png">
<meta property="og:updated_time" content="2019-10-15T07:21:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)">
<meta name="twitter:description" content="Challenge Lab 8: linkCode: linkReference: Wikipedia Brute-force Substring Matching1234567891011// string: helloworld// pattern: owo// n = 10, m = 3function NaiveSearch(string s[1..n], string pattern[">
<meta name="twitter:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/vmqyw.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.junhaow.com/studynotes/cs61b/cs61b clab8 string.html">





  <title>CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm) | B_L_OO_GGG</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-146643833-1', 'auto');
  ga('send', 'pageview');
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">


  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">B_L_OO_GGG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Sumomo mo momo mo no uchi</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home


            

            

            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-inbox"></i> <br>
            
            Archives


            

            
              <span class="badge">49</span>
            

            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-studynotes">
          <a href="/studynotes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-pencil"></i> <br>
            
            Study Notes


            

            

            
              <span class="badge">6</span>
            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-lc">
          <a href="/lc/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            LeetCode Book


            

            

            

            
              <span class="badge badge-lc">251 / ‚àû</span>
            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-games">
          <a href="/games/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-gamepad"></i> <br>
            
            Games I've Played


            

            

            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-address-card"></i> <br>
            
            About Me


            

            

            

            

            
              <span class="badge-about">üëã</span>
            

          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

	<h1 class="post-title" itemprop="name headline">CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)</h1>



</header>

      
      
      
      <div class="post-body">
        
        
          <p><br></p>
<p>Challenge Lab 8: <a href="https://sp19.datastructur.es/materials/clab/clab8/clab8" target="_blank" rel="noopener">link</a><br>Code: <a href="https://github.com/junhaowww/cs61b-sp18/tree/master/clab8" target="_blank" rel="noopener">link</a><br>Reference: <a href="https://en.wikipedia.org/wiki/Rabin%E2%80%93Karp_algorithm" target="_blank" rel="noopener">Wikipedia</a></p>
<h2 id="Brute-force-Substring-Matching"><a href="#Brute-force-Substring-Matching" class="headerlink" title="Brute-force Substring Matching"></a>Brute-force Substring Matching</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string: helloworld</span></span><br><span class="line"><span class="comment">// pattern: owo</span></span><br><span class="line"><span class="comment">// n = 10, m = 3</span></span><br><span class="line"><span class="function">function <span class="title">NaiveSearch</span><span class="params">(string s[<span class="number">1.</span>.n], string pattern[<span class="number">1.</span>.m])</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> i from <span class="number">1</span> to n-m+<span class="number">1</span>: <span class="comment">// n-m+1 ~ n</span></span><br><span class="line">    <span class="keyword">for</span> j from <span class="number">1</span> to m: <span class="comment">// m</span></span><br><span class="line">      <span class="keyword">if</span> s[i+j-<span class="number">1</span>] != pattern[j]:</span><br><span class="line">        jump to next iteration of outer loop</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> not found</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This algorithm works well in many practical cases, but can exhibit relatively <code>long running times</code> in certain examples, such as searching for a pattern string of 10,000 ‚Äúa‚Äùs followed by a single ‚Äúb‚Äù in a search string of 10 million ‚Äúa‚Äùs, in which case it exhibits its worst-case $O(nm)$ time.</p>
<ul>
<li>The <code>Knuth-Morris-Pratt algorithm</code> reduces this to $O(n)$ using pre-computation to examine each text character only once. (<a href="https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm" target="_blank" rel="noopener">wiki link (nice explanation)</a>)</li>
<li>The <code>Boyer-Moore algorithm</code> skips forward not by 1 character, but by as many as possible for the search to succeed. It focuses on the outer loop.</li>
</ul>
<p>The Rabin-Karp algorithm focuses on the inner loop.</p>
<h2 id="Rabin-Karp-algorithm"><a href="#Rabin-Karp-algorithm" class="headerlink" title="Rabin-Karp algorithm"></a>Rabin-Karp algorithm</h2><p>This algorithm uses hashing to find any one of a set of pattern strings a text. For text of length $n$ and $p$ patterns of combined length $m$, its average and best case running time is $O(n + m)$ in space $O(p)$, but its worst-case time is $O(nm)$.</p>
<p>In contrast, the <code>Aho‚ÄìCorasick string-matching algorithm</code> has asymptotic worst-time complexity $O(n+m)$ in space $O(m)$.</p>
<p>A practical application of the algorithm is <code>detecting plagiarism</code>.</p>
<h3 id="Use-hashing-for-shifting-substring-search"><a href="#Use-hashing-for-shifting-substring-search" class="headerlink" title="Use hashing for shifting substring search"></a>Use hashing for shifting substring search</h3><p>Rather than pursuing more sophisticated <code>skipping</code>, the Rabin‚ÄìKarp algorithm seeks to <code>speed up the testing of equality</code> of the pattern to the substrings in the text by using a <code>hash function</code>.</p>
<p>The algorithm exploits the fact that if two strings are equal, their hash values are also equal. Thus, string matching is reduced (almost) to computing the hash value of the search pattern and then looking for substrings of the input string with that hash value.</p>
<p>One problem is that because there are so many different strings and so few hash values, <code>some differing strings will have the same hash value</code>. If the hash values match, the pattern and the substring may not match; consequently, the potential match of search pattern and the substring must be confirmed by comparing them; that comparison can take a long time for long substrings.</p>
<p>Luckily, a <code>good hash function</code> on reasonable strings usually does not have many collisions, so the expected search time will be acceptable.</p>
<p><strong>The algorithm is as shown:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">RabinKarp</span><span class="params">(string s[<span class="number">1.</span>.n], string pattern[<span class="number">1.</span>.m])</span> </span>&#123;</span><br><span class="line">  patternHash := hash(pattern[<span class="number">1</span>..m]);  <span class="comment">// A: O(m)</span></span><br><span class="line">  <span class="keyword">for</span> i from <span class="number">1</span> to n-m+<span class="number">1</span>:   <span class="comment">// ~ n times</span></span><br><span class="line">    stringHash := hash(s[i..i+m-<span class="number">1</span>])    <span class="comment">// B: O(m)</span></span><br><span class="line">    <span class="keyword">if</span> patternHash = stringHash:       <span class="comment">// C: O(n) C determines whether D is executed</span></span><br><span class="line">      <span class="keyword">if</span> s[i..i+m-<span class="number">1</span>] = pattern[<span class="number">1</span>..m]:  <span class="comment">// D: O(m)</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> not found</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Runtime analysis:</strong></p>
<p>Naively <code>computing the hash value</code> for an m-length string requires $O(m)$ time because each character is examined.</p>
<p>Lines A, B, and D each require $O(m)$ time. However, Line A is only executed once, and Line D is only executed if the hash values match, which is unlikely to happen more than a few times.</p>
<p>Line C is executed $O(n)$ times, but each comparison only requires constant time, so its impact is $O(n)$. The issue is Line B: <code>stringHash := hash(s[i..i+m-1])</code></p>
<p>So, with the naive method of computing the hash value of the substring on each loop, the algorithm requires $O(nm)$ time, the same complexity as the aforementioned brute-force method.</p>
<p><strong>Rolling Hash</strong></p>
<p>For speed, the hash must be computed in constant time. The trick is the variable <code>stringHash</code> already contains the previous hash value of <code>s[i..i+m-1]</code>. If that value can be used to compute the next hash value in constant time, then computing successive hash values will be fast.</p>
<p>The trick can be exploited using a <code>rolling hash</code>. A rolling hash is a hash function specially designed to enable this operation. A trivial (but not very good) rolling hash function just adds the values of each character in the substring. This rolling hash formula can compute the next hash value from the previous value in constant time:</p>
<p><code>s[i+1..i+m] = s[i..i+m-1] - s[i] + s[i+m]</code></p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/vmqyw.png" alt=""></p>
<p>But this hashing method like other poor hash methods will result in poor performance in Line C (<code>if patternHash = stringHash:</code>) and it would be executed $O(n)$ times. And the following character-by-character comparison of strings with length $m$ takes $O(m)$ time, the whole algorithm then takes a worst-case $O(nm)$ time.</p>
<h3 id="Rabin-fingerprint"><a href="#Rabin-fingerprint" class="headerlink" title="Rabin fingerprint"></a>Rabin fingerprint</h3><p>The key to the Rabin‚ÄìKarp algorithm‚Äôs performance is the efficient computation of hash values of the successive substrings of the text. The <code>Rabin fingerprint</code> is a popular and effective rolling hash function. </p>
<p>The hash function described here is not a <a href="https://en.wikipedia.org/wiki/Rabin_fingerprint" target="_blank" rel="noopener">Rabin fingerprint</a>, but it works equally well. It treats every substring as a number in some <code>base</code>, the base being usually the size of the character set.</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/a4y7d.png" alt="" title="Wikipedia: Rabin fingerprint"></p>
<p>For example, if the substring is ‚Äúhi‚Äù, the base is <code>256</code>, and prime modules is <code>101</code>, then the hash value would be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&apos;h&apos; = 104</span><br><span class="line">&apos;i&apos; = 105</span><br><span class="line">[ ( 104 x 256 ) % 101 + 105 ] % 101 = 65</span><br></pre></td></tr></table></figure>
<p>For example (hash rolling), if we have text ‚Äúabracadabra‚Äù and we are searching for a pattern of length 3, the hash of the first substring ‚Äúabr‚Äù, using <code>256</code> as the base and <code>101</code> as the prime modulus is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&apos;a&apos; = 97</span><br><span class="line">&apos;b&apos; = 98</span><br><span class="line">&apos;r&apos; = 114</span><br><span class="line">1st: (97 x 256) % 101</span><br><span class="line">2nd: ( (97 x 256) % 101 x 256 + 98 ) % 101</span><br><span class="line">3rd: [ ( ( (97 x 256) % 101 x 256 + 98 ) % 101 ) x 256 + 114 ] % 101</span><br><span class="line">hash(&quot;abr&quot;) = [( ( (97 x 256) % 101 x 256 + 98 ) % 101 ) x 256 + 114 ] % 101</span><br><span class="line">            = (97 x 256^2 + 98 x 256 + 114) % 101</span><br><span class="line">            = (52 + 40 + 114) % 101</span><br><span class="line">            = (92 + 114) % 101 = 206 % 101 = 4</span><br><span class="line">            or = ((52 % 101) + (40 % 101) + (114 % 101)) % 101 = 4</span><br></pre></td></tr></table></figure>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/46wcq.png" alt=""></p>
<script type="math/tex; mode=display">(x + y) \bmod{z} = \left[ x \bmod{z} + y \bmod{z} \right] \bmod{z}</script><script type="math/tex; mode=display">(x \times y) \bmod{z} = \left[(x \bmod{z}) \times (y\bmod{z})\right] \bmod{z}</script><p>Then we compute the hash of the next substring, ‚Äúbra‚Äù, from the hash ‚Äúabr‚Äù by <code>subtracting</code> the number added for the first ‚Äòa‚Äô, i.e. $97 \times 256^2$, multiplying by the base and adding for the last ‚Äòa‚Äô of ‚Äúbra‚Äù, i.e. $97 \times 256^0$.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hash(&quot;abr&quot;) = (97 x 256^2 + 98  x 256 + 114) % 101</span><br><span class="line">hash(&quot;bra&quot;) = (98 x 256^2 + 114 x 256 + 97)  % 101</span><br><span class="line">// How can we compute hash(&quot;bra&quot;) from hash(&quot;abr&quot;)?</span><br><span class="line">hash(&quot;bra&quot;) = [(hash(&quot;abr&quot;) - 1st Term) x 256 + New Term] % 101</span><br><span class="line">            = [(hash(&quot;abr&quot;) - 97 x 256^2) x 256 + 97] % 101</span><br></pre></td></tr></table></figure>
<p>Although <code>((256 % 101) x 256) % 101</code> is the same as <code>256^2 % 101</code>, to avoid <code>overflowing</code> integer maximums when the pattern string is longer (e.g. ‚ÄòRabin-Karp‚Äô is 10 characters, <code>256^9</code> is the offset without modulation), the pattern length base offset is pre-calculated in a loop, modulating the result each iteration.</p>
<p>If the substrings in question are long, this algorithm achieves great savings compared with many other hashing schemes.</p>
<h3 id="Multiple-pattern-search"><a href="#Multiple-pattern-search" class="headerlink" title="Multiple pattern search"></a>Multiple pattern search</h3><p>The Rabin-Karp algorithm is an algorithm of choice for multiple pattern search.</p>
<p>To find any of a large number, say $k$, fixed length patterns in a text, a simple variant of the algorithm uses a <code>Bloom filter</code> or a <code>set data structure</code> to check whether the hash of a given string belongs to a set of hash values of patterns we are looking for:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">RabinKarpSet</span><span class="params">(string s[<span class="number">1.</span>.n], set of string subs, m)</span>:</span></span><br><span class="line"><span class="function">  set hsubs :</span>= emptySet</span><br><span class="line">  foreach sub in subs:</span><br><span class="line">    <span class="function">insert <span class="title">hash</span><span class="params">(sub[<span class="number">1.</span>.m] into hsubs)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">for</span> i from 1 to n-m+1:</span></span><br><span class="line"><span class="function">    hs :</span>= hash(s[i+<span class="number">1</span>..i+m])</span><br><span class="line">    <span class="keyword">if</span> hs in hsubs and s[i..i+m-<span class="number">1</span>] in subs:</span><br><span class="line">      <span class="keyword">return</span> i</span><br><span class="line">  <span class="keyword">return</span> not found</span><br></pre></td></tr></table></figure>
<p>We assume all the substrings have a fixed length $m$.</p>
<p>A na√Øve way to search for $k$ patterns is to repeat a single-pattern search taking $O(n+m)$ time, totaling in $O((n+m)k)$ time. In contrast, the above algorithm above can find all k patterns in $O(n+km)$ expected time, assuming that a hash table check works in $O(1)$ expected time. A deterministic $O(n+km)$ solution is the <code>Aho‚ÄìCorasick algorithm</code>.</p>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p><a href="https://github.com/junhaowww/cs61b-sp18/blob/master/clab8/RollingString.java" target="_blank" rel="noopener">RollingString.java</a><br><a href="https://github.com/junhaowww/cs61b-sp18/blob/master/clab8/RabinKarpAlgorithm.java" target="_blank" rel="noopener">RabinKarpAlgorithm.java</a></p>
<h2 id="KMP-Implementation"><a href="#KMP-Implementation" class="headerlink" title="KMP Implementation"></a>KMP Implementation</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KMP</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//           1         2</span></span><br><span class="line">  <span class="comment">// m: 01234567890123456789012</span></span><br><span class="line">  <span class="comment">// S: ABC ABCDAB ABCDABCDABDE</span></span><br><span class="line">  <span class="comment">// W:     ABCDABD</span></span><br><span class="line">  <span class="comment">// i:     0123456</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ABC ABCD AB EF ABCD GGG (input)</span></span><br><span class="line">  <span class="comment">//     ABCD AB EF ABCD EEE (pattern)</span></span><br><span class="line">  <span class="comment">//     0123 45 67 8901 234</span></span><br><span class="line">  <span class="comment">//          AB vs ABCD</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmp</span><span class="params">(String input, String pattern)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = input.length();    <span class="comment">// 0 1 2 3 4 (n = 5, m = 3)</span></span><br><span class="line">    <span class="keyword">int</span> m = pattern.length();  <span class="comment">// A B C</span></span><br><span class="line">    <span class="keyword">if</span> (m &gt; n) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> inputOffset = <span class="number">0</span>;       <span class="comment">// potential input jump</span></span><br><span class="line">    <span class="keyword">int</span> patternOffset = <span class="number">0</span>;     <span class="comment">// potential starting pattern offset</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n - m + <span class="number">1</span>; ) &#123;</span><br><span class="line">      inputOffset = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = patternOffset; j &lt; m; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == patternOffset) patternOffset = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> currentPos = i + j;  <span class="comment">// current position of input string</span></span><br><span class="line">        <span class="comment">// equal - match or move on and record potential</span></span><br><span class="line">        <span class="keyword">if</span> (input.charAt(currentPos) == pattern.charAt(j)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (j == m - <span class="number">1</span>) <span class="keyword">return</span> i;  <span class="comment">// match and return</span></span><br><span class="line">          <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;  <span class="comment">// if j == 0 -&gt; first time -&gt; don't record</span></span><br><span class="line">            <span class="keyword">if</span> (input.charAt(currentPos) == pattern.charAt(patternOffset)) &#123;</span><br><span class="line">              inputOffset = (inputOffset == <span class="number">0</span>) ? currentPos : inputOffset;</span><br><span class="line">              patternOffset += <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              inputOffset = <span class="number">0</span>;    <span class="comment">// reset</span></span><br><span class="line">              patternOffset = <span class="number">0</span>;  <span class="comment">// reset</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// not equal - should stop</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (inputOffset == <span class="number">0</span> &amp;&amp; patternOffset == <span class="number">0</span>) &#123; <span class="comment">// jump to the farthest</span></span><br><span class="line">            i = (j &gt; <span class="number">0</span>) ? currentPos : currentPos + <span class="number">1</span>;    <span class="comment">// if stop initially</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123; <span class="comment">// jump to the potential matching position</span></span><br><span class="line">            i = inputOffset;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;  <span class="comment">// back to outer loop</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// test</span></span><br><span class="line">    String input = <span class="string">"ABC ABCDAB ABCDABCDABDE"</span>;</span><br><span class="line">    String pattern = <span class="string">"ABCDABD"</span>;</span><br><span class="line">    <span class="keyword">int</span> result = kmp(input, pattern);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      </div>
      
      
      
    </div>
    
    
    
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/cat_with_glasses.jpg" alt="Junhao Wang">
            
              <p class="site-author-name" itemprop="name">Junhao Wang</p>
              <p class="site-description motion-element" itemprop="description">Debug the old world, bug the new world!</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">113</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/chuckwangg" target="_blank" title="Facebook">
                      
                        <i class="fa fa-fw fa-facebook"></i>Facebook</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/junhaowww" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/junhaowww/" target="_blank" title="LinkedIn">
                      
                        <i class="fa fa-fw fa-linkedin"></i>LinkedIn</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.douban.com/people/maodai/" target="_blank" title="Ë±ÜÁì£ (Book)">
                      
                        <i class="fa fa-fw fa-book"></i>Ë±ÜÁì£ (Book)</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/41865efdad5d/" title="Xiaofud" target="_blank">Xiaofud</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.davex.pw/" title="DaveX" target="_blank">DaveX</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://alexfan.xyz/" title="alexfan.xyz" target="_blank">alexfan.xyz</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Brute-force-Substring-Matching"><span class="nav-number">1.</span> <span class="nav-text">Brute-force Substring Matching</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rabin-Karp-algorithm"><span class="nav-number">2.</span> <span class="nav-text">Rabin-Karp algorithm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-hashing-for-shifting-substring-search"><span class="nav-number">2.1.</span> <span class="nav-text">Use hashing for shifting substring search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rabin-fingerprint"><span class="nav-number">2.2.</span> <span class="nav-text">Rabin fingerprint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-pattern-search"><span class="nav-number">2.3.</span> <span class="nav-text">Multiple pattern search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation"><span class="nav-number">2.4.</span> <span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KMP-Implementation"><span class="nav-number">3.</span> <span class="nav-text">KMP Implementation</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Junhao Wang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>








        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://junhaow.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://www.junhaow.com/studynotes/cs61b/cs61b clab8 string.html';
          this.page.identifier = 'studynotes/cs61b/cs61b clab8 string.html';
          this.page.title = 'CS 61B | Challenge Lab 8 | String Matching Problem (Rabin-Karp algorithm)';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://junhaow.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  


  

  


</body>
</html>
