<!DOCTYPE html>




<html class="theme-next pisces" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,300italic,400,400italic,700,700italic|Bitter:300,300italic,400,400italic,700,700italic|Bitter:300,300italic,400,400italic,700,700italic|Menlo:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="junhaow, maodai">










<meta name="description" content="å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰ä»‹ç»å¦‚ä½•ä½¿ç”¨ JUnit è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŒæ¡ç¼–å†™å•å…ƒæµ‹è¯•çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼‚å¸¸æµ‹è¯•ï¼Œå‚æ•°åŒ–æµ‹è¯•å’Œè¶…æ—¶æµ‹è¯•ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰">
<meta property="og:url" content="http://www.junhaow.com/studynotes/java/Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰.html">
<meta property="og:site_name" content="B_L_OO_GGG">
<meta property="og:description" content="å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰ä»‹ç»å¦‚ä½•ä½¿ç”¨ JUnit è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŒæ¡ç¼–å†™å•å…ƒæµ‹è¯•çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼‚å¸¸æµ‹è¯•ï¼Œå‚æ•°åŒ–æµ‹è¯•å’Œè¶…æ—¶æµ‹è¯•ã€‚">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/yuxo6.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/t0qa6.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/9sqhz.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/qjmdp.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/in99m.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/hmy97.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/q3icw.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/com11.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/s2okl.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/pcf1d.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/2c19u.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/6ndgr.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/cd6kk.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/rcnzf.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/zr6k9.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/2qj8d.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/4t7ae.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/asx6a.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/w6fzw.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/kmox5.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/u02da.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/tmhv9.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/y6tuo.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/n5q8r.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/ms3si.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/1eh13.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/k6q90.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/0ppro.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/kw9qz.jpg">
<meta property="og:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/d3cgm.jpg">
<meta property="og:updated_time" content="2019-04-26T17:52:37.048Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰">
<meta name="twitter:description" content="å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰ä»‹ç»å¦‚ä½•ä½¿ç”¨ JUnit è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŒæ¡ç¼–å†™å•å…ƒæµ‹è¯•çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼‚å¸¸æµ‹è¯•ï¼Œå‚æ•°åŒ–æµ‹è¯•å’Œè¶…æ—¶æµ‹è¯•ã€‚">
<meta name="twitter:image" content="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/yuxo6.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.junhaow.com/studynotes/java/Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰.html">





  <title>Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰ | B_L_OO_GGG</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-146643833-1', 'auto');
  ga('send', 'pageview');
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">


  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">B_L_OO_GGG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Sumomo mo momo mo no uchi</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home


            

            

            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-inbox"></i> <br>
            
            Archives


            

            
              <span class="badge">50</span>
            

            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-studynotes">
          <a href="/studynotes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-pencil"></i> <br>
            
            Study Notes


            

            

            
              <span class="badge">6</span>
            

            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-lc">
          <a href="/lc/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            LeetCode Book


            

            

            

            
              <span class="badge badge-lc">251 / âˆ</span>
            

            

          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-address-card"></i> <br>
            
            About Me


            

            

            

            

            
              <span class="badge-about">ğŸ‘‹</span>
            

          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

	<h1 class="post-title" itemprop="name headline">Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰</h1>



</header>

      
      
      
      <div class="post-body">
        
        
          <p><br></p>
<h2 id="å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰"><a href="#å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰" class="headerlink" title="å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰"></a>å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰</h2><p>ä»‹ç»å¦‚ä½•ä½¿ç”¨ JUnit è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ŒæŒæ¡ç¼–å†™å•å…ƒæµ‹è¯•çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼‚å¸¸æµ‹è¯•ï¼Œå‚æ•°åŒ–æµ‹è¯•å’Œè¶…æ—¶æµ‹è¯•ã€‚</p>
<a id="more"></a>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼š</p>
<ul>
<li>å•å…ƒæµ‹è¯•æ˜¯é’ˆå¯¹æœ€å°çš„åŠŸèƒ½å•å…ƒç¼–å†™æµ‹è¯•ä»£ç </li>
<li>Java ç¨‹åºæœ€å°çš„åŠŸèƒ½å•å…ƒæ˜¯æ–¹æ³•</li>
<li>å•å…ƒæµ‹è¯•å°±æ˜¯é’ˆå¯¹å•ä¸ª Java æ–¹æ³•çš„æµ‹è¯•</li>
</ul>
<p>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼ŒTest-Driven Developmentï¼‰</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/yuxo6.jpg" alt=""></p>
<p>å¥½å¤„ï¼š</p>
<ul>
<li>ç¡®ä¿å•ä¸ªæ–¹æ³•è¿è¡Œæ­£å¸¸</li>
<li>å¦‚æœä¿®æ”¹äº†æ–¹æ³•ä»£ç ï¼Œåªéœ€ç¡®ä¿å…¶å¯¹åº”çš„å•å…ƒæµ‹è¯•é€šè¿‡</li>
<li>æµ‹è¯•ä»£ç æœ¬èº«å°±å¯ä»¥ä½œä¸ºç¤ºä¾‹ä»£ç </li>
<li>å¯ä»¥è‡ªåŠ¨åŒ–è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶è·å¾—æŠ¥å‘Š</li>
</ul>
<p>JUnit æ˜¯ä¸€ä¸ªå¼€æºçš„ Java è¯­è¨€çš„å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚</p>
<ul>
<li>ä¸“é—¨é’ˆå¯¹ Java è¯­è¨€è®¾è®¡ï¼Œä½¿ç”¨å¹¿æ³›</li>
<li>JUnit æ˜¯æ ‡å‡†å•å…ƒæµ‹è¯•æ¡†æ¶</li>
</ul>
<p>JUnit çš„è®¾è®¡ï¼š</p>
<ul>
<li>TestCaseï¼šè¡¨ç¤ºä¸€ä¸ªæµ‹è¯•</li>
<li>TestSuiteï¼šè¡¨ç¤ºä¸€ç»„æµ‹è¯•ï¼ˆTestCaseï¼‰</li>
<li>TestFixtureï¼šè¡¨ç¤ºä¸€ä¸ªæµ‹è¯•ç¯å¢ƒ</li>
<li>TestResultï¼šç”¨äºæ”¶é›†æµ‹è¯•ç»“æœ</li>
<li>TestRunnerï¼šç”¨äºè¿è¡Œæµ‹è¯•</li>
<li>TestListenerï¼šç”¨äºç›‘å¬æµ‹è¯•è¿‡ç¨‹ï¼Œæ”¶é›†æµ‹è¯•æ•°æ®</li>
<li>Assertï¼šç”¨äºæ–­è¨€æµ‹è¯•ç»“æœæ˜¯å¦æ­£ç¡®</li>
</ul>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ JUnit åªéœ€è¦å…³æ³¨ TestCase å’Œ Assert å³å¯ã€‚</p>
<p>JUnit ä¸‰ä¸ªç‰ˆæœ¬ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/t0qa6.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// fail("Not yet implemented");</span></span><br><span class="line">    assertEquals(<span class="number">3</span>, <span class="keyword">new</span> Calculator().calculate(<span class="string">"1 + 2"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculateWithSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(<span class="number">3</span>, <span class="keyword">new</span> Calculator().calculate(<span class="string">" 1 + 2"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ Assert æ–­è¨€ï¼š</p>
<ul>
<li>ç›¸ç­‰ï¼šassertEquals(100, x)</li>
<li>æ•°ç»„ç›¸ç­‰ï¼šassertArrayEquals({1, 2, 3}, x)</li>
<li>æµ®ç‚¹æ•°ç›¸ç­‰ï¼šassertEquals(3.1416, x, 0.0001);</li>
<li>nullï¼šassertNull(x)</li>
<li>true / falseï¼šassertTrue(x &gt; 0)ã€assertFalse(x &lt; 0)</li>
<li>å…¶ä»–ï¼šassertNotEquals / assertNotNull</li>
</ul>
<p>è®¾è®¡åŸåˆ™ï¼š</p>
<ul>
<li>æ¯ä¸ªæµ‹è¯•æ–¹æ³•å¿…é¡»å®Œå…¨ç‹¬ç«‹</li>
<li>æµ‹è¯•ä»£ç å¿…é¡»éå¸¸ç®€å•</li>
<li>ä¸èƒ½ä¸ºæµ‹è¯•ä»£ç å†ç¼–å†™æµ‹è¯•</li>
<li>æµ‹è¯•éœ€è¦è¦†ç›–å„ç§è¾“å…¥æ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯è¾¹ç•Œæ¡ä»¶</li>
</ul>
<h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>åˆå§‹åŒ–æµ‹è¯•èµ„æºç§°ä¸º Fixtureï¼š</p>
<ul>
<li>@Beforeï¼šåˆå§‹åŒ–æµ‹è¯•å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šinput = new FileInputStream()</li>
<li>@Afterï¼šé”€æ¯ @Before åˆ›å»ºçš„æµ‹è¯•å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šinput.close()</li>
<li>@BeforeClassï¼šåˆå§‹åŒ–éå¸¸è€—æ—¶çš„èµ„æºï¼Œä¾‹å¦‚ï¼šåˆ›å»ºæ•°æ®åº“</li>
<li>@AfterClassï¼šæ¸…ç† @BeforeClass åˆ›å»ºçš„èµ„æºï¼Œä¾‹å¦‚ï¼šåˆ é™¤æ•°æ®åº“</li>
</ul>
<p>JUnit ä½¿ç”¨ @Before å’Œ @Afterï¼š</p>
<ul>
<li>åœ¨ @Before æ–¹æ³•ä¸­åˆå§‹åŒ–æµ‹è¯•èµ„æº</li>
<li>åœ¨ @After æ–¹æ³•ä¸­é‡Šæ”¾æµ‹è¯•èµ„æº</li>
</ul>
<p>å®ƒä»¬å¯ä»¥ä¿è¯å•ä¸ª @Test æ–¹æ³•æ‰§è¡Œå‰ä¼šåˆ›å»ºæ–°çš„ XxxTest å®ä¾‹ï¼Œä¸”å˜é‡çš„çŠ¶æ€ä¸ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ª @Test æ–¹æ³•ã€‚</p>
<p>JUnit å¯¹äºæ¯ä¸ª @Test æ–¹æ³•ï¼š</p>
<ul>
<li>å®ä¾‹åŒ– CalculatorTest</li>
<li>æ‰§è¡Œ @Before æ–¹æ³•</li>
<li>æ‰§è¡Œ @Test æ–¹æ³•</li>
<li>æ‰§è¡Œ @After æ–¹æ³•</li>
</ul>
<p>@BeforeClass å’Œ @AfterClass é™æ€æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æ‰§è¡Œæ‰€æœ‰ @Test æ–¹æ³•å‰æ‰§è¡Œ @BeforeClass é™æ€æ–¹æ³•</li>
<li>æ‰§è¡Œæ‰€æœ‰æµ‹è¯•</li>
<li>åœ¨æ‰§è¡Œæ‰€æœ‰ @Test æ–¹æ³•åæ‰§è¡Œ @AfterClass é™æ€æ–¹æ³•</li>
</ul>
<p>æ³¨æ„ï¼šè¿™äº›é™æ€æ–¹æ³•åªèƒ½ä½œç”¨äºé™æ€å˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @BeforeClass</span></span><br><span class="line">invokeBeforeClass(CalculatorTest.class);</span><br><span class="line"><span class="keyword">for</span> (Method testMethod : findTestMethods(CalculatorTest.class)) &#123;</span><br><span class="line">  CalculatorTest test = <span class="keyword">new</span> CalculatorTest();</span><br><span class="line">  test.setUp();  <span class="comment">// @Before</span></span><br><span class="line">  testMethod.invoke(test);  <span class="comment">// @Test</span></span><br><span class="line">  test.tearDown();  <span class="comment">// @After</span></span><br><span class="line">&#125;</span><br><span class="line">invokeAfterClass(CalculatorTest.class);</span><br><span class="line"><span class="comment">// @AfterClass</span></span><br></pre></td></tr></table></figure>
<p>æ¨¡æ¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line">  Calculator calc;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@BeforeClass</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpBeforeClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// foo</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@AfterClass</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownAfterClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// foo</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Before</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// before</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@After</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// after</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// test1</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// test2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚å¸¸æµ‹è¯•"><a href="#å¼‚å¸¸æµ‹è¯•" class="headerlink" title="å¼‚å¸¸æµ‹è¯•"></a>å¼‚å¸¸æµ‹è¯•</h3><p>å¯¹å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> testNumberFormatException &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Integer.parseInt(<span class="keyword">null</span>);</span><br><span class="line">    fail(<span class="string">"Should throw exception"</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="comment">// ok</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¼šå†™å¾ˆå¤š try ä»£ç ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ expected æµ‹è¯•å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(expected = NumberFormatException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNumberFormatException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Integer.parse(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‚æ•°åŒ–æµ‹è¯•"><a href="#å‚æ•°åŒ–æµ‹è¯•" class="headerlink" title="å‚æ•°åŒ–æµ‹è¯•"></a>å‚æ•°åŒ–æµ‹è¯•</h3><p>æƒ³æµ‹è¯•æ•°æ®ç»„ç»‡èµ·æ¥ï¼Œå¹¶è°ƒç”¨ç›¸åŒçš„æµ‹è¯•æ–¹æ³•ã€‚</p>
<ul>
<li>å‚æ•°å¿…é¡»ç”±é™æ€æ–¹æ³• data() è¿”å›</li>
<li>è¿”å›ç±»å‹ä¸º Collecgtion<object[]></object[]></li>
<li>é™æ€æ–¹æ³•å¿…é¡»æ ‡è®°ä¸º @Parameters</li>
<li>æµ‹è¯•ç±»å¿…é¡»æ ‡è®°ä¸º @RunWith(Parameterized.class)</li>
<li>æ„é€ æ–¹æ³•å‚æ•°å¿…é¡»å’Œæµ‹è¯•å‚æ•°ä¸€ä¸€å¯¹åº”</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(Parameterized.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsTest</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Parameters</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Collection&lt;?&gt; data () &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="keyword">new</span> Object[][]&#123;</span><br><span class="line">      &#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">1</span>&#125;, &#123;-<span class="number">1</span>, <span class="number">1</span>&#125; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> input;</span><br><span class="line">  <span class="keyword">int</span> expected;</span><br><span class="line">  <span class="comment">// Constructor</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AbsTest</span><span class="params">(<span class="keyword">int</span> input, <span class="keyword">int</span> expected)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.input = input;</span><br><span class="line">    <span class="keyword">this</span>.expected = expected;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAbs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r = Math.abs(<span class="keyword">this</span>.input);</span><br><span class="line">    assertEquals(<span class="keyword">this</span>.expected, r);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¶…æ—¶æµ‹è¯•"><a href="#è¶…æ—¶æµ‹è¯•" class="headerlink" title="è¶…æ—¶æµ‹è¯•"></a>è¶…æ—¶æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(timeout = <span class="number">1000</span>) <span class="comment">// ä¸€ç§’</span></span><br><span class="line"><span class="comment">// foo</span></span><br></pre></td></tr></table></figure>
<h2 id="å¤„ç†æ—¥æœŸå’Œæ—¶é—´"><a href="#å¤„ç†æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="å¤„ç†æ—¥æœŸå’Œæ—¶é—´"></a>å¤„ç†æ—¥æœŸå’Œæ—¶é—´</h2><p>ä»‹ç» Java å¤„ç†æ—¥æœŸå’Œæ—¶é—´çš„æ–°æ—§ä¸¤å¥— APIï¼Œç†è§£æ—¥æœŸã€æœ¬åœ°æ—¶é—´ã€æ—¶åŒºã€æ—¶é—´æˆ³çš„æ¦‚å¿µï¼ŒæŒæ¡ Java å¤„ç†æ—¥æœŸå’Œæ—¶é—´çš„åŸºæœ¬ç”¨æ³•å’Œæœ€ä½³å®è·µã€‚</p>
<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="æ—¶åˆ»ä¸æ—¶åŒº"><a href="#æ—¶åˆ»ä¸æ—¶åŒº" class="headerlink" title="æ—¶åˆ»ä¸æ—¶åŒº"></a>æ—¶åˆ»ä¸æ—¶åŒº</h4><p>æ—¶åˆ»ï¼ˆTimeã€Instantï¼‰-&gt; <code>2017-1-1 20:21:59</code></p>
<p>æ—¶åŒºçš„å‡ ç§è¡¨ç¤ºæ–¹æ³•ï¼š</p>
<ul>
<li>GMT+08:00</li>
<li>UTC+08:00ï¼ˆä»¥ä¸Šä¸¤è€…åŸºæœ¬ç­‰ä»·ï¼ŒUTC æ˜¯ç”¨æ›´ç²¾ç¡®çš„åŸå­è®¡æ—¶ï¼Œä½†å¯å¿½ç•¥ï¼‰</li>
<li>CSTï¼ˆChina Standard Time / Central Standard Time USAï¼‰</li>
<li>Asia/Shanghaiï¼ˆå›½é™…æ ‡å‡†ç»„ç»‡è§„å®šçš„åŸå¸‚ï¼‰</li>
</ul>
<h4 id="å¤ä»¤æ—¶"><a href="#å¤ä»¤æ—¶" class="headerlink" title="å¤ä»¤æ—¶"></a>å¤ä»¤æ—¶</h4><p>å¤ä»¤æ—¶ / Daylight Saving Timeã€‚</p>
<p>æˆ‘å›½ 1992 å¹´å°±åºŸé™¤äº†å¤ä»¤æ—¶ï¼Œä½†ç¾å›½äººè¿˜åœ¨ä½¿ç”¨ã€‚</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/9sqhz.jpg" alt="" title="å¤ä»¤æ—¶"></p>
<p>åŒä¸€åœ°åŒºç”¨ GMT / UTC å’Œ<code>åŸå¸‚è¡¨ç¤ºçš„æ—¶åŒº</code>å¯èƒ½å¯¼è‡´æ—¶é—´ä¸åŒï¼Œå¦‚ï¼šGMT / UTC æ—¶é—´å’Œçº½çº¦æ—¶é—´ä¸ä¸€æ ·ã€‚</p>
<h4 id="åœ°åŒº"><a href="#åœ°åŒº" class="headerlink" title="åœ°åŒº"></a>åœ°åŒº</h4><p>Locale è¡¨ç¤ºä¸€ä¸ªå›½å®¶æˆ–åœ°åŒºçš„æ—¥æœŸã€æ—¶é—´ã€æ•°å­—ã€è´§å¸ç­‰<code>æ ¼å¼</code>ï¼š</p>
<ul>
<li>zh_CNï¼š2016-11-30</li>
<li>en_USï¼š11/30/2016</li>
</ul>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/qjmdp.jpg" alt="" title="ä¸­å›½å’Œç¾å›½çš„åœ°åŒºæ ¼å¼"></p>
<h3 id="java-util-çš„-API"><a href="#java-util-çš„-API" class="headerlink" title="java.util çš„ API"></a>java.util çš„ API</h3><p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/in99m.jpg" alt="" title="å­˜å‚¨æ–¹å¼ vs. å±•ç¤ºæ–¹å¼"></p>
<p>æ—¶é—´çš„å±•ç¤ºæ–¹å¼ï¼š</p>
<ul>
<li>2016-11-20 8:15:01 GMT+08:00</li>
<li>2016-11-20 0:15:01 GMT+00:00</li>
<li>11/19/2016 19:15:01 America/New_York</li>
</ul>
<p>æ—¶é—´å­˜å‚¨æ–¹å¼ï¼š</p>
<ul>
<li>Epoch Timeï¼ˆTimestamp æ—¶é—´æˆ³ï¼‰ï¼šä» 1970 å¹´ 1 æœˆ 1 æ—¥é›¶ç‚¹ï¼ˆæ ¼æ—å¨æ²»æ—¶åŒºï¼‰åˆ°ç°åœ¨ç»å†çš„ç§’æ•°ï¼Œä¾‹å¦‚ï¼š<ul>
<li>åŒ—äº¬ 2016-11-20 8:15:01 = 1479600901</li>
<li>ä¼¦æ•¦ 2016-11-20 0:15:01 = 1479600901</li>
</ul>
</li>
<li>æˆ–è€…æ¯«ç§’æ•°ï¼š<ul>
<li>åŒ—äº¬ 2016-11-20 8:15:01.123 = 1479600901<code>123</code></li>
</ul>
</li>
<li>æˆ–è€…æµ®ç‚¹æ•°ï¼š<ul>
<li>åŒ—äº¬ 2016-11-20 8:15:01.123 = 1479600901<code>.123</code></li>
</ul>
</li>
</ul>
<p>Java é‡Œé¢ Epoch Time æ˜¯é€šè¿‡<code>long t = 1479600901123L</code> çš„æ–¹å¼å­˜å‚¨çš„ã€‚</p>
<p>JDK æ–°æ—§ APIï¼ˆå†å²é—ç•™åŸå› ï¼Œä½†ç›®å‰è¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨æ–° APIï¼‰ï¼š</p>
<ul>
<li>java.util<ul>
<li>Date</li>
<li>Calendar</li>
</ul>
</li>
<li>java.time (JDK &gt;= 1.8)<ul>
<li>LocalDate</li>
<li>LocalTime</li>
<li>ZonedDateTime</li>
<li>Instant</li>
</ul>
</li>
</ul>
<h4 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h4><p>Date ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥è·å–å½“å‰ç³»ç»Ÿæ—¶é—´æˆ³</span></span><br><span class="line">System.currentTimtMillis();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">Date now = <span class="keyword">new</span> Date();</span><br><span class="line">System.out.println(now);</span><br><span class="line"><span class="keyword">long</span> t = now.getTime();</span><br><span class="line">System.out.println(t);</span><br><span class="line">System.out.println(<span class="keyword">new</span> Date(t)); <span class="comment">// Date è½¬ long</span></span><br><span class="line"><span class="comment">// Mon Nov 14 19:35:24 CST 2016</span></span><br></pre></td></tr></table></figure>
<p>è½¬æ¢ä¸º Stringï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢ä¸º String</span></span><br><span class="line">now.toString();</span><br><span class="line">now.toGMTString();</span><br><span class="line">now.toLocaleStirng();</span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">String s = sdf.format(now);</span><br><span class="line"><span class="comment">// String è§£æä¸º Date</span></span><br><span class="line">Date d = sdf.parse(<span class="string">"2016-11-30 13:14:15"</span>);</span><br><span class="line"><span class="comment">// å¦‚æœè¦è§£æå…¶ä»– Localeï¼ˆé»˜è®¤ä½¿ç”¨ç³»ç»Ÿçš„ï¼‰</span></span><br><span class="line">String s2 = <span class="string">"Nov/20/2016 12:15:59"</span>;</span><br><span class="line">Date date2 = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"MMM/dd/yyyy HH:mm:ss"</span>, Locale.US).parseï¼ˆs2);</span><br><span class="line"><span class="comment">// ISO 8601 æ ‡å‡†æ ¼å¼è§£æ</span></span><br><span class="line">String iso = <span class="string">"2016-11-20T12:15:59"</span>;</span><br><span class="line">Date date3 = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd'T'HH:mm:ss"</span>).parse(iso);</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> year = d.getYear() + <span class="number">1900</span>;</span><br><span class="line"><span class="keyword">int</span> month = d.getMonth() + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> date = d.getDate();</span><br><span class="line"><span class="keyword">int</span> hour = d.getHours();</span><br><span class="line"><span class="keyword">int</span> minutes = d.getMinutes();</span><br><span class="line"><span class="keyword">int</span> seconds = d.getSeconds();</span><br><span class="line"><span class="keyword">int</span> day = d.getDay();</span><br></pre></td></tr></table></figure>
<p>Java.util.Date çš„é—®é¢˜ï¼š</p>
<ul>
<li>ä¸èƒ½è½¬æ¢æ—¶åŒº</li>
<li>æ—¥æœŸå’Œæ—¶é—´çš„åŠ å‡</li>
<li>ä¸¤ä¸ªæ—¥æœŸç›¸å·®å¤šå°‘å¤©</li>
<li>è®¡ç®—æŸä¸ªæœˆç¬¬ä¸€ä¸ªæ˜ŸæœŸä¸€</li>
</ul>
<h4 id="Calendar"><a href="#Calendar" class="headerlink" title="Calendar"></a>Calendar</h4><p>Calendar ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Calendar cal = Calendar.getInstance();</span><br><span class="line">cal.setTime(<span class="keyword">new</span> Date());</span><br><span class="line">Date d1 = cal.getTime();</span><br><span class="line">cal.get(Calendar.YEAR);</span><br><span class="line">cal.get(Calendar.MONTH);</span><br><span class="line">cal.get(Calendar.WEEK_OF_MONTH);</span><br><span class="line">cal.get(Calendar.DAY_OF_MONTH);</span><br></pre></td></tr></table></figure>
<p>æ“ä½œ Operationï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// operation - add</span></span><br><span class="line">cal.add(Calendar.MONTH, <span class="number">1</span>);</span><br><span class="line">cal.set(<span class="number">2016</span>,<span class="number">08</span>,<span class="number">01</span>);</span><br><span class="line"></span><br><span class="line">String[] strDays = <span class="keyword">new</span> String[] &#123;</span><br><span class="line">    <span class="string">"SUNDAY"</span>, <span class="string">"MONDAY"</span>, <span class="string">"TUESDAY"</span>, <span class="string">"WEDNESDAY"</span>,</span><br><span class="line">    <span class="string">"THURSDAY"</span>, <span class="string">"FRIDAY"</span>, <span class="string">"SATURDAY"</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(strDays[cal.get(Calendar.DAY_OF_WEEK) - <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// operation - after</span></span><br><span class="line">Calendar c1 = Calendar.getInstance();</span><br><span class="line">Calendar c2 = Calendar.getInstance();</span><br><span class="line">c1.set(<span class="number">2018</span>, <span class="number">05</span>, <span class="number">06</span>);</span><br><span class="line">c2.set(<span class="number">2018</span>, <span class="number">05</span>, <span class="number">09</span>);</span><br><span class="line"><span class="keyword">boolean</span> isAfter = c1.after(c2);</span><br><span class="line"><span class="comment">// also, "before"</span></span><br></pre></td></tr></table></figure>
<h3 id="java-time-çš„-API"><a href="#java-time-çš„-API" class="headerlink" title="java.time çš„ API"></a>java.time çš„ API</h3><h4 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h4><ul>
<li>LocalDate</li>
<li>LocalTime</li>
<li>LocalDateTime</li>
</ul>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/hmy97.jpg" alt="" title="java.time ç±»å›¾"></p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/q3icw.jpg" alt="" title="TemporalAmount çš„å­ç±»"></p>
<p>TemporalAmount è¡¨ç¤ºä¸€æ®µæ—¶é—´ï¼š1 å¤© / 2 å°æ—¶ / 30 åˆ†é’Ÿ</p>
<p>æ–° API ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸¥æ ¼åŒºåˆ†æ—¥æœŸå’Œæ—¶é—´</li>
<li>ä¸å˜ç±»ï¼ˆç±»ä¼¼ Stringï¼‰</li>
<li>Month èŒƒå›´ 1 ~ 12ï¼ˆJan ~ Decï¼‰</li>
<li>Week èŒƒå›´ 1 ~ 7ï¼ˆMon ~ Sunï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">LocalDate d = LocalDate.now();</span><br><span class="line">LocalTime t = LocalTime.now();</span><br><span class="line">LocalDateTime dt = LocalDateTime.now();</span><br><span class="line"><span class="comment">// ä¸¥æ ¼æŒ‰ç…§ ISO 8601 æ ¼å¼æ‰“å° 2016-11-30T15:16:17.012</span></span><br><span class="line"></span><br><span class="line">LocalDate d2 = LocalDate.of(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">30</span>);</span><br><span class="line">LocalTime t2 = LocalTime.of(<span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>);</span><br><span class="line">LocalDateTime dt2 = LocalDateTime.of(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>);</span><br><span class="line">LocalDateTime dt3 = LocalDateTime.of(d2, t2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// format</span></span><br><span class="line"><span class="comment">// DateTimeFormatter å¯¹è±¡ä¸å¯å˜</span></span><br><span class="line">DateTimeFormatter dtf = DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">System.out.println(dtf.format(LocalDateTime.now()));</span><br><span class="line"><span class="comment">// parse</span></span><br><span class="line">LocalDateTime dt2 = LocalDateTime.parse(<span class="string">"2016-11-30 15:16:17"</span>, dtf);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œé»˜è®¤æŒ‰ç…§ ISO æ ‡å‡†è¿›è¡Œæ ¼å¼åŒ–å’Œè§£æï¼š</p>
<ul>
<li>yyyy-MM-dd</li>
<li>HH:mm:ss</li>
<li>HH:mm:ss.SSS</li>
<li>yyyy-MM-ddâ€™Tâ€™HH:mm:ss</li>
<li>yyyy-MM-ddâ€™Tâ€™HH:mm:ss.SSS</li>
</ul>
<p>å¯¹æ—¥æœŸå’Œæ—¶é—´è¿›è¡ŒåŠ å‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸ºæ˜¯ä¸å˜ç±»ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯æ–°çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">// +5 days</span></span><br><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line">LocalDate after5days = today.plusDays(<span class="number">5</span>);</span><br><span class="line"><span class="comment">// -2 hours</span></span><br><span class="line">LocalDateTime now = LocalDateTime.now();</span><br><span class="line">LocalDateTime before2hours = now.minusHours(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// +1 month -2 weeks</span></span><br><span class="line">LocalDate d = today.plusMonths(<span class="number">1</span>).minusWeeks(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>å¯¹æ—¥æœŸå’Œæ—¶é—´è¿›è¡Œè°ƒæ•´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ¬æœˆç¬¬ä¸€å¤©</span></span><br><span class="line">LocalDate firstDay = LocalDate.now().withDayofMonth(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// æŠŠç§’å’Œçº³ç§’è°ƒæ•´ä¸º 0</span></span><br><span class="line">LocalTime at = LocalTime.now().withSecond(<span class="number">0</span>).withNano(<span class="number">9</span>);</span><br><span class="line"><span class="comment">// æœ¬æœˆæœ€åä¸€å¤©</span></span><br><span class="line">LocalDate lastDay = LocalDate.now().with(TemporalAdjusters.lastDayOfMonth());</span><br><span class="line"><span class="comment">// æœ¬æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥</span></span><br><span class="line">LocalDate firstSunday = LocalDate.now().with(TemporalAdjusters.firstInMonth(DayOfWeek.SUNDAY));</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­æ—¥æœŸå…ˆåï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LocalDate d1 = LocalDate.of(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">20</span>);</span><br><span class="line">LocalDate d2 = LocalDate.of(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">21</span>);</span><br><span class="line"><span class="comment">// d1.isBefore(d2)</span></span><br><span class="line"><span class="comment">// d1.isAfter(d2);</span></span><br><span class="line"><span class="comment">// d1.isEquals(d2);</span></span><br></pre></td></tr></table></figure>
<p>è®¡ç®—æ—¥æœŸçš„ Periodï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LocalDate d1 = LocalDate.of(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">20</span>);</span><br><span class="line">LocalDate d2 = LocalDate.of(<span class="number">2050</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">Period p = d1.until(d2);</span><br><span class="line">System.out.println(p); <span class="comment">// P33Y1M12D</span></span><br><span class="line"><span class="comment">// p.getYears()</span></span><br><span class="line"><span class="comment">// p.getMonths()</span></span><br><span class="line"><span class="comment">// p.getDays()</span></span><br><span class="line"><span class="comment">// æˆ–è€… d2.toEpochDay() - d1.toEpochDay()</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong>LocalDateTime æ— æ³•ä¸ long è¿›è¡Œè½¬æ¢ï¼Œå› ä¸º LocalDateTime æ²¡æœ‰æ—¶åŒºï¼Œæ— æ³•ç¡®å®šæŸä¸€æ—¶åˆ»ï¼›è€Œ ZonedDateTime æœ‰æ—¶åŒºï¼Œå¯ä»¥ä¸ long è¿›è¡Œè½¬æ¢ã€‚</p>
<h4 id="ZonedDateTime"><a href="#ZonedDateTime" class="headerlink" title="ZonedDateTime"></a>ZonedDateTime</h4><p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/com11.jpg" alt="" title="java.time ç±»çš„å…³ç³»å›¾"></p>
<p><code>ZonedDateTime = LocalDateTime + ZoneId</code></p>
<ul>
<li>ZonedDateTimeï¼šå¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´</li>
<li>ZoneIdï¼šæ–°çš„æ—¶åŒºå¯¹è±¡ï¼ˆå–ä»£æ—§çš„ java.util.TimeZoneï¼‰</li>
<li>Instantï¼šæ—¶åˆ»å¯¹è±¡ï¼ˆepoch secondsï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å‰æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´</span></span><br><span class="line">ZonedDateTime zbj = ZonedDateTime.now();</span><br><span class="line">System.out.println(zbj.getZone()); <span class="comment">// æ‰“å°æ—¶åŒº</span></span><br><span class="line"><span class="comment">// çº½çº¦æ—¶åŒºçš„å½“å‰æ—¥æœŸå’Œæ—¶é—´</span></span><br><span class="line">ZonedDateTime zny = ZonedDateTime.now(ZoneId.oF(<span class="string">"America/New_York"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä» LocalDateTime è½¬æ¢</span></span><br><span class="line">LocalDateTime ldt = LocalDateTime.of(<span class="number">2016</span>, <span class="number">11</span>, <span class="number">30</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">59</span>);</span><br><span class="line">ZonedDateTime bj = ldt.atZone(ZoneId.systemDefault());</span><br><span class="line">ZonedDateTime ny = ldt.atZone(ZoneId.of(<span class="string">"America/Ney_York"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¶åŒºè½¬æ¢</span></span><br><span class="line">ZonedDateTime ny = bj.withZoneSameInstant(ZoneId.of(<span class="string">"America/New_York"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Instant å¯¹è±¡</span></span><br><span class="line">Instant ins = Instant.now();</span><br><span class="line">Instant ins2 = ZonedDateTime.now().toInstant();</span><br><span class="line">ZonedDateTime zdt = ins.atZone(ZoneId.of(<span class="string">"Z"</span>));</span><br><span class="line"><span class="keyword">long</span> epoch = ins.getEpochSecond(); <span class="comment">// æ³¨æ„æ˜¯ç§’</span></span><br></pre></td></tr></table></figure>
<h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><p>java.util.Data çš„ä¸åˆç†è®¾è®¡ï¼šåŒæ—¶è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´ã€‚</p>
<p>Java å¯¹è±¡ - æ•°æ®åº“ç±»å‹çš„å¯¹åº”å…³ç³»ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/s2okl.jpg" alt="" title="Java å¯¹è±¡ - æ•°æ®åº“ç±»å‹"></p>
<p>æ–°æ—§ API çš„è½¬æ¢æ–¹æ³•ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/pcf1d.jpg" alt=""></p>
<p>ä¸‰æ¡å¿ å‘Šï¼š</p>
<ul>
<li>æ˜¾ç¤ºæ—¥æœŸå’Œæ—¶é—´å…ˆè½¬æ¢æˆ Stringï¼ˆlong -&gt; Stringï¼‰</li>
<li>è®© JDK å¤„ç†æ—¶åŒºï¼ˆä¸è¦ä¸»åŠ¨å¹²æ¶‰ï¼‰</li>
<li>ä¸è¦æ‰‹åŠ¨è°ƒæ•´æ—¶å·®</li>
</ul>
<h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><p>ä»‹ç»æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€ï¼ŒæŒæ¡å¦‚ä½•ä½¿ç”¨ Java å†…ç½®çš„ç±»æ“ä½œæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬ç®€å•åŒ¹é…ã€å¤æ‚åŒ¹é…ã€åˆ†ç»„åŒ¹é…ã€è´ªå©ªåŒ¹é…ã€éè´ªå©ªåŒ¹é…ã€æœç´¢å’Œæ›¿æ¢ç­‰å¸¸ç”¨æ“ä½œã€‚</p>
<h3 id="åŒ¹é…è§„åˆ™"><a href="#åŒ¹é…è§„åˆ™" class="headerlink" title="åŒ¹é…è§„åˆ™"></a>åŒ¹é…è§„åˆ™</h3><p>JDK å†…ç½®æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼šjava.util.regex</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"hahah"</span>;</span><br><span class="line"><span class="keyword">if</span> (s.matches(<span class="string">"regex"</span>)) &#123;</span><br><span class="line">  <span class="comment">// foo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä»å·¦åˆ°å³ä¾æ¬¡åŒ¹é…</li>
<li>ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰<code>\&amp;</code>ï¼ˆè½¬æ¢ä¸º Java å­—ç¬¦ä¸²åæ˜¯ <code>\\&amp;</code>ï¼‰ï¼Œé ASCII å­—ç¬¦ç”¨<code>\u####</code>è¡¨ç¤º</li>
<li><code>.</code>åŒ¹é…ä»»ä½•å­—ç¬¦ï¼Œå¦‚<code>a.c</code>ï¼ˆä½†ä¸èƒ½åŒ¹é…<code>ac</code>ã€<code>abbc</code>ï¼‰</li>
<li><code>\d</code>åŒ¹é…ä¸€ä¸ªæ•°å­—</li>
<li><code>\w</code>åŒ¹é…ä¸€ä¸ªå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿</li>
<li><code>\s</code>åŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œ tab</li>
<li><code>\D</code>åŒ¹é…ä¸€ä¸ªéæ•°å­—</li>
<li><code>\W</code>åŒ¹é…ä¸€ä¸ªéå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿</li>
<li><p><code>\S</code>åŒ¹é…ä¸€ä¸ªéç©ºç™½å­—ç¬¦</p>
</li>
<li><p>ä¿®é¥°ç¬¦<code>*</code>åŒ¹é…ä»»æ„ï¼ˆé›¶ä¸ªæˆ–å¤šä¸ªï¼‰ä¸ªå­—ç¬¦ï¼Œå¦‚<code>A\d*</code>åŒ¹é…<code>A</code>ã€<code>A1</code>ã€<code>A007</code></p>
</li>
<li>ä¿®é¥°ç¬¦<code>+</code>åŒ¹é…è‡³å°‘ä¸€ä¸ªå­—ç¬¦</li>
<li>ä¿®é¥°ç¬¦<code>?</code>åŒ¹é…é›¶ä¸ªæˆ–ä¸€ä¸ªå­—ç¬¦</li>
<li>ä¿®é¥°ç¬¦<code>{n}</code>åŒ¹é… n ä¸ªå­—ç¬¦</li>
<li>ä¿®é¥°ç¬¦<code>{n,m}</code>åŒ¹é… n ~ m ä¸ªå­—ç¬¦</li>
<li>ä¿®é¥°ç¬¦<code>{n,}</code>åŒ¹é…è‡³å°‘ n ä¸ªå­—ç¬¦</li>
<li>ä¿®é¥°ç¬¦<code>{0,m}</code>åŒ¹é…è‡³å¤š 3 ä¸ªå­—ç¬¦</li>
</ul>
<h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><h4 id="å¤æ‚åŒ¹é…è§„åˆ™"><a href="#å¤æ‚åŒ¹é…è§„åˆ™" class="headerlink" title="å¤æ‚åŒ¹é…è§„åˆ™"></a>å¤æ‚åŒ¹é…è§„åˆ™</h4><ul>
<li><code>^</code>å’Œ<code>$</code>åŒ¹é…å¼€å¤´å’Œç»“å°¾ï¼Œä½†ç”±äº Java é»˜è®¤åŒ¹é…å•è¡Œï¼Œæ‰€ä»¥å¯ä»¥ä¸åŠ </li>
<li><code>[...]</code>åŒ¹é…èŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚<code>[abc]5</code>ã€<code>[a-f]5</code>ï¼ˆæ³¨æ„åªèƒ½åŒ¹é…é‡Œé¢çš„ä¸€ä¸ªå­—ç¬¦ï¼‰ã€<code>[a-f0-9]{6}</code>ã€<code>[a-f0-9_]</code></li>
<li><code>[^0-9]</code>åŒ¹é…éèŒƒå›´å†…çš„å­—ç¬¦</li>
<li><code>AB|CD</code>åŒ¹é… AB æˆ– CD</li>
<li><code>(AB|CD)</code>åŒ¹é… AB æˆ– CDï¼Œå¦‚<code>learn\s(java|php)</code>ï¼ˆæ‹¬å·å¾ˆé‡è¦ï¼Œ<code>\s</code>æ˜¯ç©ºæ ¼ï¼‰</li>
</ul>
<h4 id="åˆ†ç»„åŒ¹é…è§„åˆ™"><a href="#åˆ†ç»„åŒ¹é…è§„åˆ™" class="headerlink" title="åˆ†ç»„åŒ¹é…è§„åˆ™"></a>åˆ†ç»„åŒ¹é…è§„åˆ™</h4><p><code>(...)</code>å¯ä»¥åˆ†ç»„ï¼šæå–<code>å¹´-æœˆ-æ—¥</code>ï¼Œ<code>([1-9]\d{3})\-(\d{1,2})\-(\d{1,2})</code></p>
<p>æå– 24 å°æ—¶æ—¶é—´ ##:##<br><code>^ ([0-1][0-9] | 2[0-3]) \: ([0-5][0-9]) $</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¶å® String å†…éƒ¨è°ƒç”¨çš„å°±æ˜¯ Pattern å’Œ Matcher</span></span><br><span class="line">Pattern pat = Pattern.compile(<span class="string">"regex"</span>);</span><br><span class="line">Matcher mat = pat.matcher(<span class="string">"string"</span>);</span><br><span class="line"><span class="comment">// æˆ– boolean pat.matcher("string").matches()</span></span><br><span class="line"><span class="keyword">boolean</span> isMatched = mat.matches();</span><br></pre></td></tr></table></figure>
<p>åå¤ä½¿ç”¨ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²è¿›è¡Œå¿«é€ŸåŒ¹é…æ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºè¦æŠŠæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ç¼–è¯‘ä¸º Pattern å¯¹è±¡ï¼Œç”šè‡³ Pattern å¯¹è±¡å¯ä»¥è®¾ç½®ä¸º static fieldã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿæå–å­ä¸²</span></span><br><span class="line"><span class="keyword">if</span> (matcher.matches()) &#123;</span><br><span class="line">  <span class="comment">// è¦å…ˆæ£€æŸ¥æ˜¯å¦æå–æˆåŠŸ</span></span><br><span class="line">  String whole = matcher.group(<span class="number">0</span>);</span><br><span class="line">  String areaCode = matcher.group(<span class="number">1</span>);</span><br><span class="line">  String telNumber = matcher.group(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="éè´ªå©ªåŒ¹é…"><a href="#éè´ªå©ªåŒ¹é…" class="headerlink" title="éè´ªå©ªåŒ¹é…"></a>éè´ªå©ªåŒ¹é…</h4><p>é—®é¢˜ï¼šåˆ¤æ–­æ•°å­—æœ«å°¾ 0 çš„ä¸ªæ•°</p>
<p><code>123000</code>ï¼š3 ä¸ª 0<br><code>10100</code>ï¼š2 ä¸ª 0<br><code>1001</code>ï¼š0 ä¸ª 0</p>
<p>æ­£åˆ™è¡¨è¾¾å¼ï¼š<code>^(\d+)(0*)&amp;</code></p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/2c19u.jpg" alt="" title="ç»“æœ"></p>
<p>æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤ä½¿ç”¨è´ªå©ªåŒ¹é…ï¼Œå°½å¯èƒ½å¤šåœ°å‘ååŒ¹é…ã€‚å¯ä»¥ä½¿ç”¨<code>?</code>å®ç°éè´ªå©ªåŒ¹é…ï¼š<code>^(\d+?)(0*)$</code>ã€‚</p>
<p>ä½†æ³¨æ„ï¼š<code>^(\d??)(9*)$</code>ï¼Œç¬¬ä¸€ä¸ª<code>?</code>æŒ‡åŒ¹é… 0 ä¸ªæˆ– 1 ä¸ªï¼Œç¬¬äºŒä¸ª<code>?</code>æŒ‡éè´ªå©ªåŒ¹é…ã€‚æ‰€ä»¥ï¼Œæ‰”ä¸ª<code>9999</code>è¿‡å»ï¼Œç¬¬ä¸€ç»„åŒ¹é…çš„ç»“æœä¸ºç©ºã€‚</p>
<h4 id="æœç´¢å’Œæ›¿æ¢"><a href="#æœç´¢å’Œæ›¿æ¢" class="headerlink" title="æœç´¢å’Œæ›¿æ¢"></a>æœç´¢å’Œæ›¿æ¢</h4><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²å­—ç¬¦ä¸²ï¼š</p>
<ul>
<li>String[] String.split(String regex)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"a b c"</span>.split(<span class="string">"\\s"</span>);</span><br><span class="line"><span class="string">"a b  c"</span>.split(<span class="string">"\\s+"</span>);</span><br><span class="line"><span class="string">"a, b ;; c"</span>.split(<span class="string">"[\\,\\;\\s]+"</span>);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢å­—ç¬¦ä¸²ï¼š</p>
<ul>
<li>Matcher.find()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"the quick brown fox jumps over the lazy dog."</span>;</span><br><span class="line">Pattern p = Pattern.compile(<span class="string">"the"</span>, Pattern.CASE_INSENSITIVE); <span class="comment">// å¤§å°å†™ä¸æ•æ„Ÿ</span></span><br><span class="line">Matcher m = p.matcher(s);</span><br><span class="line"><span class="keyword">while</span> (m.find()) &#123;</span><br><span class="line">    String sub = s.substring(m.start(), m.end());</span><br><span class="line">    System.out.println(sub);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "\w*o\w" åŒ¹é…å•è¯ä¸­æœ‰å­—æ¯ o çš„å•è¯</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢å­—ç¬¦ä¸²ï¼š</p>
<ul>
<li>String.replaceAll()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">"The     quick brown fox jumps   over the    lazy dog."</span>;</span><br><span class="line">String r = s.replaceAll(<span class="string">"\\s+"</span>, <span class="string">" "</span>);</span><br><span class="line"><span class="comment">// åˆ é™¤äº†å¤šä½™çš„ç©ºæ ¼</span></span><br><span class="line">String r2 = r.replaceAll(<span class="string">"(\\w+)"</span>, <span class="string">"&lt;b&gt;$1&lt;/b&gt;"</span>);</span><br><span class="line"><span class="comment">// $1 åå‘å¼•ç”¨ (\\w+) çš„åŒ¹é…ç»“æœ</span></span><br></pre></td></tr></table></figure>
<h2 id="å¤šçº¿ç¨‹ç¼–ç¨‹"><a href="#å¤šçº¿ç¨‹ç¼–ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹ç¼–ç¨‹"></a>å¤šçº¿ç¨‹ç¼–ç¨‹</h2><p>ä»‹ç» Java å¤šçº¿ç¨‹ç¼–ç¨‹çš„æ¦‚å¿µï¼ŒæŒæ¡å¤šçº¿ç¨‹çº¿ç¨‹ã€çº¿ç¨‹åŒæ­¥ã€é«˜çº§ concurrent åŒ…æä¾›çš„ Lockã€Conditionã€Concurrenté›†åˆã€Atomicã€çº¿ç¨‹æ± ã€Futureã€CompletableFutureã€Fork/Joinï¼Œä»¥åŠ ThreadLocal ç­‰ã€‚</p>
<h3 id="çº¿ç¨‹çš„æ¦‚å¿µ"><a href="#çº¿ç¨‹çš„æ¦‚å¿µ" class="headerlink" title="çº¿ç¨‹çš„æ¦‚å¿µ"></a>çº¿ç¨‹çš„æ¦‚å¿µ</h3><h4 id="å¤šçº¿ç¨‹ç®€ä»‹"><a href="#å¤šçº¿ç¨‹ç®€ä»‹" class="headerlink" title="å¤šçº¿ç¨‹ç®€ä»‹"></a>å¤šçº¿ç¨‹ç®€ä»‹</h4><p>å¤šè¿›ç¨‹ vs. å¤šçº¿ç¨‹</p>
<ul>
<li>åˆ›å»ºè¿›ç¨‹æ¯”åˆ›å»ºçº¿ç¨‹<code>å¼€é”€å¤§</code></li>
<li>è¿›ç¨‹é—´é€šä¿¡æ¯”çº¿ç¨‹é—´<code>é€šä¿¡æ…¢</code></li>
<li>å¤šè¿›ç¨‹ç¨³å®šæ€§æ¯”å¤šçº¿ç¨‹é«˜ï¼ˆä¸€ä¸ª<code>çº¿ç¨‹çš„å´©æºƒ</code>ä¼šå½±å“æ•´ä¸ªè¿›ç¨‹ï¼‰</li>
</ul>
<p>åœ¨ Java ä¸­ï¼š</p>
<ul>
<li>ä¸€ä¸ª Java ç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ª JVM è¿›ç¨‹ã€‚</li>
<li>JVM ç”¨ä¸€ä¸ª<code>ä¸»çº¿ç¨‹</code>æ¥æ‰§è¡Œ main() æ–¹æ³•</li>
<li>åœ¨ main() æ–¹æ³•ä¸­åˆå¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹</li>
</ul>
<p>å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹éœ€è¦è¯»å†™å…±äº«æ•°æ®</li>
<li>å¤šçº¿ç¨‹ç»å¸¸éœ€è¦åŒæ­¥</li>
<li>å¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚åº¦é«˜ï¼Œè°ƒè¯•æ›´å›°éš¾</li>
</ul>
<p>Java å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹æ¨¡å‹æ˜¯ Java ç¨‹åºæœ€åŸºæœ¬çš„å¹¶å‘æ¨¡å‹</li>
<li>ç½‘ç»œã€æ•°æ®åº“ã€Web ç­‰éƒ½ä¾èµ–å¤šçº¿ç¨‹æ¨¡å‹</li>
<li>å¿…é¡»æŒæ¡ Java å¤šçº¿ç¨‹ç¼–ç¨‹æ‰èƒ½ç»§ç»­æ·±å…¥å­¦ä¹ </li>
</ul>
<h4 id="åˆ›å»ºæ–°çº¿ç¨‹"><a href="#åˆ›å»ºæ–°çº¿ç¨‹" class="headerlink" title="åˆ›å»ºæ–°çº¿ç¨‹"></a>åˆ›å»ºæ–°çº¿ç¨‹</h4><p>åˆ›å»º Thread ç±»ï¼š</p>
<ul>
<li>ä» Thread æ´¾ç”Ÿ</li>
<li>è¦†å†™ run() æ–¹æ³•</li>
<li>åˆ›å»º MyThread å®ä¾‹</li>
<li>è°ƒç”¨ start() å¯åŠ¨çº¿ç¨‹ï¼ˆæ³¨æ„ä¸€ä¸ªçº¿ç¨‹åªèƒ½è°ƒç”¨ä¸€æ¬¡ start æ–¹æ³•ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥è°ƒç”¨ run æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œå¿…é¡»é€šè¿‡ start æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">    System.out.println();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Thread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">    t.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç° Runnable æ¥å£ï¼ˆå¦‚æœä¸€ä¸ªç±»å·²ç»ä»æŸä¸ªç±»æ´¾ç”Ÿï¼Œæ— æ³•ä» Thread ç»§æ‰¿ï¼‰ï¼š</p>
<ul>
<li>å®ç° Runnable æ¥å£</li>
<li>è¦†å†™ run() æ–¹æ³•</li>
<li>åœ¨ main() æ–¹æ³•ä¸­åˆ›å»º Runnable å®ä¾‹</li>
<li>åˆ›å»º Thread å®ä¾‹å¹¶ä¼ å…¥ Runnable</li>
<li>è°ƒç”¨ start() å¯åŠ¨çº¿ç¨‹</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> run &#123;</span><br><span class="line">    System.out.println();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Runnable r = <span class="keyword">new</span> MyThread();</span><br><span class="line">    Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">    t.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="comment">// synchronized åŒæ­¥</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    start();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// native è¡¨ç¤ºè¿™ä¸ªæ–¹æ³• JVM å†…éƒ¨ C ä»£ç å®ç°çš„</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li>å¯ä»¥å¯¹çº¿ç¨‹è®¾å®šä¼˜å…ˆçº§<ul>
<li><code>Thread.setPriority(int n) // 1 ~ 10ï¼Œé»˜è®¤å€¼ 5</code></li>
</ul>
</li>
<li>ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ä¼˜å…ˆçº§é«˜</li>
<li><strong>ä¸èƒ½</strong>é€šè¿‡è®¾ç½®ä¼˜å…ˆçº§æ¥ç¡®ä¿åŠŸèƒ½çš„æ‰§è¡Œé¡ºåº</li>
</ul>
<h4 id="çº¿ç¨‹çš„çŠ¶æ€"><a href="#çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€"></a>çº¿ç¨‹çš„çŠ¶æ€</h4><p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/6ndgr.jpg" alt="" title="çº¿ç¨‹çš„çŠ¶æ€"></p>
<p>çº¿ç¨‹ç»ˆæ­¢çš„åŸå› ï¼š</p>
<ul>
<li>run() æ–¹æ³•æ‰§è¡Œåˆ° return è¯­å¥è¿”å›ï¼ˆçº¿ç¨‹æ­£å¸¸ç»ˆæ­¢ï¼‰</li>
<li>å› ä¸ºæœªæ•è·çš„å¼‚å¸¸å¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼ˆçº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼‰</li>
<li>å¯¹æŸä¸ªçº¿ç¨‹çš„ Thread å®ä¾‹è°ƒç”¨ stop() æ–¹æ³•å¼ºåˆ¶ç»ˆæ­¢ï¼ˆä¸æ¨èï¼‰</li>
</ul>
<p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›´åˆ°å…¶è¿è¡Œç»“æŸï¼ˆå¯ä»¥æŒ‡å®šç­‰å¾…æ—¶é—´ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> run &#123;</span><br><span class="line">    System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  Thread t = <span class="keyword">new</span> MyThread();</span><br><span class="line">  System.out.println(<span class="string">"START"</span>);</span><br><span class="line">  t.start();</span><br><span class="line">  t.join();  <span class="comment">// ç­‰å¾… MyThread t æ‰§è¡Œç»“æŸ</span></span><br><span class="line">  System.out.println(<span class="string">"END"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹å·²ç»ç»“æŸçš„è°ƒç”¨ join æ–¹æ³•ä¼šç«‹åˆ»è¿”å›ã€‚</p>
<h4 id="ä¸­æ–­çº¿ç¨‹"><a href="#ä¸­æ–­çº¿ç¨‹" class="headerlink" title="ä¸­æ–­çº¿ç¨‹"></a>ä¸­æ–­çº¿ç¨‹</h4><p>ä¸­æ–­çº¿ç¨‹éœ€è¦é€šè¿‡æ£€æµ‹ isInterrupted() æ ‡å¿—ï¼Œå…¶ä»–çº¿ç¨‹é€šè¿‡è°ƒç”¨ interrupt() æ–¹æ³•ä¸­æ–­è¯¥çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!isInterrupted()) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Hello!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Thread t = <span class="keyword">new</span> HelloThread();</span><br><span class="line">    t.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);  <span class="comment">// ç­‰å¾… 1 ç§’</span></span><br><span class="line">    t.interrup();  <span class="comment">// ä¸­æ–­ t çº¿ç¨‹</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥é€šè¿‡è®¾ç½® running æ ‡å¿—ä½ï¼Œçº¿ç¨‹å…±äº«å˜é‡éœ€è¦ä½¿ç”¨ volatile å…³é”®å­—æ ‡è®°ï¼Œç¡®ä¿çº¿ç¨‹èƒ½å¤Ÿè¯»å–åˆ°æ›´æ–°åçš„å˜é‡å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> running = <span class="keyword">true</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (running) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Hello!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Thread t = <span class="keyword">new</span> HelloThread();</span><br><span class="line">    t.start();</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    t.running = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çº¿ç¨‹è®¿é—®ä¸€ä¸ªå˜é‡ä¼šæŠŠè¿™ä¸ªå˜é‡ copy ä¸€ä»½ç»™è‡ªå·±ã€‚å¦‚æœæ”¹å˜äº†å…¶å€¼ï¼Œçº¿ç¨‹ä¼šå†™å›ä¸»å­˜ï¼Œä½†è¿™ä¸ªæ—¶æœºæ˜¯ä¸ç¡®å®šçš„ã€‚</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/cd6kk.jpg" alt=""></p>
<p>volatile å…³é”®å­—çš„ç›®çš„å°±æ˜¯å‘Šè¯‰è™šæ‹Ÿæœºï¼š</p>
<ul>
<li>æ¯æ¬¡è®¿é—®å˜é‡æ—¶ï¼Œæ€»æ˜¯è·å–ä¸»å†…å­˜çš„<code>æœ€æ–°ç‰ˆæœ¬</code></li>
<li>æ¯æ¬¡ä¿®æ”¹å˜é‡åï¼Œ<code>ç«‹åˆ»å†™å›</code>åˆ°ä¸»å†…å­˜</li>
</ul>
<p>volatile å…³é”®å­—è§£å†³çš„æ˜¯å¯è§æ€§çš„é—®é¢˜ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ä¿®æ”¹åçš„å€¼ã€‚</p>
<h4 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h4><p>æœ‰ä¸€ç§çº¿ç¨‹ç›®çš„å°±æ˜¯æ— é™å¾ªç¯ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹ä¸ç»“æŸï¼ŒJVM è¿›ç¨‹å°±æ— æ³•ç»“æŸã€‚</p>
<p>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemonï¼‰ï¼š</p>
<ul>
<li>å®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸ºå…¶å®ƒçº¿ç¨‹æœåŠ¡çš„çº¿ç¨‹</li>
<li>æ‰€æœ‰<code>éå®ˆæŠ¤çº¿ç¨‹</code>éƒ½æ‰§è¡Œå®Œæ¯•åï¼ŒJVM è™šæ‹Ÿæœºé€€å‡º</li>
<li>ä¸èƒ½æŒæœ‰èµ„æºï¼ˆå¦‚æ‰“å¼€æ–‡ä»¶ï¼‰</li>
</ul>
<p>å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ï¼š<code>setDaemon(true)</code></p>
<h3 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹åŒæ­¥</h3><h4 id="synchronized-æ–¹æ³•"><a href="#synchronized-æ–¹æ³•" class="headerlink" title="synchronized æ–¹æ³•"></a>synchronized æ–¹æ³•</h4><p>å¯¹å…±äº«å˜é‡è¿›è¡Œå†™å…¥æ—¶ï¼Œæ¯”é¡»ä¿è¯æ˜¯åŸå­æ“ä½œã€‚åŸå­æ“ä½œæ˜¯æŒ‡ä¸èƒ½è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œã€‚</p>
<p>Java ä½¿ç”¨ synchronized å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">    n = n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é—®é¢˜ï¼šæ€§èƒ½ä¸‹é™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main.java</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Main.LOOP; i++) &#123;</span><br><span class="line">      <span class="comment">// synchronized(Main.LOCK) &#123;</span></span><br><span class="line">      Main.count += <span class="number">1</span>;</span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Main.LOOP; i++) &#123;</span><br><span class="line">      <span class="comment">// synchronized(Main.LOCK) &#123;</span></span><br><span class="line">      Main.count -= <span class="number">1</span>;</span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> LOOP = <span class="number">10000</span>; <span class="comment">// è¦å¤§çš„æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// public static final Object LOCK = new Object(); // é”</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Thread t1 = <span class="keyword">new</span> AddThread();</span><br><span class="line">    Thread t2 = <span class="keyword">new</span> DecThread();</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n = n + <span class="number">1</span>; <span class="comment">// ä¸æ˜¯åŸå­æ“ä½œï¼Œå¯èƒ½ä¼šæœ‰é—®é¢˜</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// åŠ é”</span></span><br><span class="line"><span class="comment">// ILOAD</span></span><br><span class="line"><span class="comment">// IADD</span></span><br><span class="line"><span class="comment">// ISTORE</span></span><br><span class="line"><span class="comment">// è§£é”</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ synchronized æ—¶<code>ä¸ç”¨æ‹…å¿ƒå¼‚å¸¸</code>ï¼Œå¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(obj) &#123;</span><br><span class="line">  <span class="keyword">if</span> (m &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.value += m;</span><br><span class="line">&#125; <span class="comment">// æ— è®ºæœ‰æ— å¼‚å¸¸ï¼Œéƒ½ä¼šåœ¨æ­¤é‡Šæ”¾é”</span></span><br></pre></td></tr></table></figure>
<p>JVM è§„èŒƒå®šä¹‰äº†å‡ ç§åŸå­æ“ä½œï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼ˆlong å’Œ double é™¤å¤–ï¼‰èµ‹å€¼ï¼š<code>int n = 100;</code></li>
<li>å¼•ç”¨ç±»å‹å¤åˆ¶ï¼š<code>List&lt;String&gt; list = anotherList;</code></li>
</ul>
<p>å› æ­¤å¯ä»¥å°†ä¸¤ä¸ª field çš„èµ‹å€¼æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œä¸€èµ·èµ‹å€¼ã€‚</p>
<p>æ­¤å¤–ï¼Œå±€éƒ¨å˜é‡ï¼ˆå’Œå½¢å‚ï¼‰ä¸éœ€è¦åŒæ­¥ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä»½è‡ªå·±çš„å‰¯æœ¬ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">avg</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> s1 = a * a + b * b;</span><br><span class="line">  <span class="keyword">int</span> s2 = a + b;</span><br><span class="line">  <span class="keyword">int</span> r = s1 / s2;</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´å¥½çš„åšæ³•ï¼šæ•°æ®å°è£…</p>
<p>æŠŠåŒæ­¥é€»è¾‘å°è£…åˆ°æŒæœ‰æ•°æ®çš„å®ä¾‹ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">      count += n;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æˆ–è€…ä½¿ç”¨ synchronized ä¿®é¥°æ–¹æ³•</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    count += n;</span><br><span class="line">  &#125; <span class="comment">// å®Œå…¨ç­‰ä»·</span></span><br><span class="line">  <span class="comment">// å¦‚æœå¯¹é™æ€æ–¹æ³•ä½¿ç”¨ thisï¼Œé”ä½çš„æ˜¯å½“å‰ç±» Counter.class</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">      count -= n;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong>è¯»å–æ–¹æ³•ä¹Ÿéœ€è¦åŒæ­¥ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šæ”¹å˜äº†å€¼ã€‚</p>
<p>å¦‚æœä¸€ä¸ªç±»è¢«è®¾è®¡ä¸ºå…è®¸å¤šçº¿ç¨‹æ­£ç¡®è®¿é—®ï¼Œè¿™ä¸ªç±»å°±æ˜¯<code>çº¿ç¨‹å®‰å…¨</code>çš„ï¼ˆthread safeï¼‰ï¼Œå¦‚ java.lang.StringBufferã€‚</p>
<p>çº¿ç¨‹å®‰å…¨çš„ç±»ï¼š</p>
<ul>
<li>ä¸å˜ç±»ï¼šStringã€Integerã€LocalDate</li>
<li>æ²¡æœ‰æˆå‘˜å˜é‡çš„ç±»ï¼šMath</li>
<li>æ­£ç¡®ä½¿ç”¨ synchronized çš„ç±»ï¼šStringBuffer</li>
</ul>
<p>éçº¿ç¨‹å®‰å…¨çš„ç±»ï¼š</p>
<ul>
<li>ä¸èƒ½å†å¤šçº¿ç¨‹ä¸­å…±äº«å®ä¾‹å¹¶ä¿®æ”¹ï¼šArrayList</li>
<li>å¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸­ä»¥åªè¯»æ–¹å¼å…±äº«</li>
</ul>
<p>ä¸€ä¸ªç±»å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œ<code>é»˜è®¤ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</code>ã€‚</p>
<h4 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h4><p>Java çš„çº¿ç¨‹é”æ˜¯<code>å¯é‡å…¥</code>çš„é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value += m;</span><br><span class="line">    addAnother(m);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAnother</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">    <span class="keyword">this</span>.another += m;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java çš„çº¿ç¨‹å¯ä»¥è·å–å¤šä¸ªä¸åŒå¯¹è±¡çš„é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span>(lockA) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value += m;</span><br><span class="line">    <span class="keyword">synchronized</span>(lockB) &#123;</span><br><span class="line">      <span class="keyword">this</span>.another += m;</span><br><span class="line">    &#125; <span class="comment">// unlock B</span></span><br><span class="line">  &#125; <span class="comment">// unlock A</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½¢æˆæ­»é”ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/rcnzf.jpg" alt=""></p>
<p>æ­»é”å½¢æˆçš„æ¡ä»¶ï¼š</p>
<ul>
<li>ä¸¤ä¸ªçº¿ç¨‹å„è‡ªæŒæœ‰ä¸åŒçš„é”</li>
<li>ä¸¤ä¸ªçº¿ç¨‹å„è‡ªè¯•å›¾è·å–å¯¹æ–¹å·²æŒæœ‰çš„é”</li>
<li>åŒæ–¹æ— çº¿ç­‰å¾…ä¸‹å»ï¼šå¯¼è‡´æ­»é”</li>
</ul>
<p>æ²¡æœ‰æœºåˆ¶è§£é™¤æ­»é”ï¼Œåªèƒ½ç»“æŸ JVM è¿è¡Œã€‚å¦‚æœæƒ³è¦é¿å…æ­»é”ï¼Œçº¿ç¨‹å–é”çš„é¡ºåºè¦ä¸€è‡´ã€‚</p>
<h4 id="wait-å’Œ-notify"><a href="#wait-å’Œ-notify" class="headerlink" title="wait å’Œ notify"></a>wait å’Œ notify</h4><p>å¤šçº¿ç¨‹åè°ƒçš„é—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskQueue</span> </span>&#123;</span><br><span class="line">  Queue&lt;String&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String s)</span> </span>&#123;  <span class="comment">// çº¿ç¨‹ 1</span></span><br><span class="line">    <span class="keyword">this</span>.queue.add(s);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (queue.isEmpty()) &#123;  <span class="comment">// çº¿ç¨‹ 2</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue.remove();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é˜Ÿåˆ—ä¸ºç©ºï¼Œçº¿ç¨‹ 2 æ­»å¾ªç¯ï¼Œæ­¤æ—¶çº¿ç¨‹ 1 åœ¨ç­‰çº¿ç¨‹ 2 çš„é”ã€‚</p>
<p>å¤šçº¿ç¨‹åè°ƒè¿è¡Œï¼šå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();     <span class="comment">// è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> queue.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>wait ä¸ä¼šè¿”å›ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’åæ‰ä¼šè¿”å›ã€‚</li>
<li>wait æ–¹æ³•çš„æ‰§è¡Œæœºåˆ¶éå¸¸å¤æ‚ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ Java æ–¹æ³•ï¼Œè€Œæ˜¯å®šä¹‰åœ¨ Object ç±»ä¸Šçš„ native æ–¹æ³•ï¼ˆC ä»£ç å®ç°ï¼‰ã€‚</li>
<li>è€Œä¸”ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ synchronized ä»£ç å—ä¸­æ‰èƒ½è°ƒç”¨ wait æ–¹æ³•ï¼Œå› ä¸º wait è°ƒç”¨çš„æ—¶å€™ä¼šé‡Šæ”¾ this é”ï¼Œè€Œ wait è¿”å›çš„æ—¶å€™åˆä¼šé‡æ–°è·å¾—é”ã€‚ï¼ˆåªèƒ½åœ¨ this å¯¹è±¡ä¸Šè°ƒç”¨ wait æ–¹æ³•ï¼‰</li>
<li>å¿…é¡»åœ¨å·²è·å¾—çš„é”å¯¹è±¡ä¸Šè°ƒç”¨ notify / notifyAll() æ–¹æ³•ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.queue.add(s);</span><br><span class="line">  <span class="keyword">this</span>.notify();  <span class="comment">// notify æ‰§è¡Œåï¼Œæ­¤æ—¶addTask çº¿ç¨‹è¿˜æ‹¿ç€é”ï¼›ç›´åˆ° wait è¿”å›åæ‰æŠŠé”ç»™äº† getTask çº¿ç¨‹</span></span><br><span class="line">  <span class="comment">// this.notifyAll() å”¤é†’å…¨éƒ¨ç­‰å¾…çº¿ç¨‹ï¼ˆæ›´å®‰å…¨ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸ºä»€ä¹ˆè¦ç”¨ whileï¼Œè€Œä¸ç”¨ if</span></span><br><span class="line">  <span class="comment">// å› ä¸ºæœ‰å¯èƒ½æœ‰å¾ˆå¤šä¸ªçº¿ç¨‹åœ¨ waitï¼Œå½“å®ƒä»¬ä» wait è¿”å›çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æœ‰æœºä¼šè·å¾— this é”ï¼Œç„¶åæ­£ç¡®çš„æ‰§è¡Œ return queue.remove()ã€‚æ­¤æ—¶é˜Ÿåˆ—ä¸ºç©ºï¼Œè€Œå…¶ä»–çº¿ç¨‹ç”±äº if åªåˆ¤æ–­ä¸€æ¬¡è€Œç›´æ¥æ‰§è¡Œäº† remove è€Œä¸æ˜¯é‡æ–°åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¯¼è‡´æŠ¥é”™ã€‚</span></span><br><span class="line">  <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> queue.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é«˜çº§-concurrent-åŒ…"><a href="#é«˜çº§-concurrent-åŒ…" class="headerlink" title="é«˜çº§ concurrent åŒ…"></a>é«˜çº§ concurrent åŒ…</h3><p>é«˜çº§ java.util.concurrent åŒ…ï¼š</p>
<ul>
<li>æ›´é«˜çº§çš„åŒæ­¥åŠŸèƒ½</li>
<li>ç®€åŒ–å¤šçº¿ç¨‹ç¨‹åºçš„ç¼–å†™</li>
<li>JDK &gt;= 1.5</li>
</ul>
<h4 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><p>java.util.locks.ReentrantLock ç”¨äºæ›¿ä»£ synchronized åŠ é”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lockObj) &#123;</span><br><span class="line">  n = n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// â†“</span></span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  n = n + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lock.lock(); <span class="comment">// lock æ–¹æ³•å¿…é¡»åœ¨ try ä¹‹å‰å®Œæˆï¼Œå› ä¸ºå¯èƒ½ä¼šå¤±è´¥ã€‚</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      n = n + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">try_inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lock.tryLock(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123; <span class="comment">// if åˆ¤æ–­ç­‰å¾…ä¸€ç§’é’Ÿï¼Œå¾—ä¸åˆ°é”å°±ä¸æ‰§è¡Œ</span></span><br><span class="line">        <span class="comment">// ä¸´ç•ŒåŒºä»£ç </span></span><br><span class="line">        n = n + <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tryLock() æ–¹æ³•å¯ä»¥å°è¯•è·å–é”å¹¶å¯æŒ‡å®šè¶…æ—¶ï¼ˆåœ¨å¤±è´¥çš„æ—¶å€™ä¸ä¼šå¯¼è‡´æ­»é”ï¼‰ã€‚</p>
<h4 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h4><p>ReentrantLock ä¿è¯äº†åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ï¼Œä½†å…¶å® get æ–¹æ³•å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ï¼Œæ¯”å¦‚è¯»å†™çš„æƒ…å†µã€‚</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/zr6k9.jpg" alt=""></p>
<p>ReadWriteLock é€‚ç”¨æ¡ä»¶ï¼š</p>
<p>åŒä¸€ä¸ªå®ä¾‹ï¼Œæœ‰å¤§é‡çº¿ç¨‹è¯»å–ï¼Œä»…æœ‰å°‘æ•°çº¿ç¨‹ä¿®æ”¹ï¼ˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> ReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line">  <span class="keyword">final</span> Lock rLock = lock.readLock();</span><br><span class="line">  <span class="keyword">final</span> Lock wLock = lock.writeLock();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    wlock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      value += <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      wlock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rlock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      rlock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><p>Condition æ›¿ä»£ wait / notify åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Lock lk = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="keyword">final</span> Condition notEmpty = lk.newCondition();</span><br><span class="line"></span><br><span class="line"><span class="comment">// await()</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  lk.lock();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">this</span>.queue.isEmpty()) &#123;</span><br><span class="line">      notEmpty.await();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue.remove();</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lk.unlock();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// signalAll()</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">  lk.lock();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.queue.add(name);</span><br><span class="line">    notEmpty.signalAll();</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lk.unlock();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Condition.await / signal / signalAll åŸç†å’Œ wait / notify / notifyAll ä¸€è‡´ã€‚</p>
<h4 id="Concurrent-é›†åˆ"><a href="#Concurrent-é›†åˆ" class="headerlink" title="Concurrent é›†åˆ"></a>Concurrent é›†åˆ</h4><p>å‰é¢ ReentrantLock + Condition å®ç°äº† Blocking Queueã€‚java.util.concurrent æä¾›äº†çº¿ç¨‹å®‰å…¨çš„ Blocking é›†åˆï¼šArrayBlockingQueueã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WorkerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  BlockingQueue&lt;String&gt; taskQueue;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">WorkerThread</span><span class="params">(BlockingQueue&lt;String&gt; taskQueue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.taskQueue = taskQueue;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!isInterrupted()) &#123;</span><br><span class="line">      String name;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        name = taskQueue.take(); <span class="comment">// ç±»ä¼¼äº get</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      String result = <span class="string">"Hello, "</span> + name + <span class="string">"!"</span>;</span><br><span class="line">      System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>java.util.concurrent æä¾›äº†çº¿ç¨‹å®‰å…¨çš„ Blocking é›†åˆï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/2qj8d.jpg" alt=""></p>
<p>java.util.Collections å·¥å…·ç±»è¿˜æä¾›äº†æ—§çš„çº¿ç¨‹å®‰å…¨é›†åˆè½¬æ¢å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map unsafeMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">Map threadSafeMap = Collections.synchronizedMap(unsafeMap);</span><br><span class="line"><span class="comment">// å®é™…æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªåŒ…è£…ç±»ï¼Œæ€§èƒ½è¾ƒä½ï¼Œä¸æ¨èä½¿ç”¨ã€‚</span></span><br></pre></td></tr></table></figure>
<p>å¤šçº¿ç¨‹åŒæ—¶è®¿é—® Blocking é›†åˆæ˜¯å®‰å…¨çš„ï¼Œå°½é‡ä½¿ç”¨ JDK æä¾›çš„ concurrent é›†åˆï¼Œé¿å…è‡ªå·±ç¼–å†™åŒæ­¥ä»£ç ã€‚</p>
<h4 id="Atomic"><a href="#Atomic" class="headerlink" title="Atomic"></a>Atomic</h4><p>java.util.concurrent.atomic æä¾›äº†ä¸€ç»„åŸå­ç±»å‹æ“ä½œï¼š</p>
<p>AtomicIntegerï¼š</p>
<ul>
<li>int addAndGet(int delta)</li>
<li>int incrementAndGet()</li>
<li>int get()</li>
<li>int compareAndSet(int expect, int update)</li>
</ul>
<p>å®ç°ä¸€ç§æ— é”ï¼ˆlock-freeï¼‰å®ç°çš„çº¿ç¨‹å®‰å…¨ï¼ˆthread-safeï¼‰è®¿é—®ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯<code>CAS</code>ï¼ˆCompare and Setï¼‰.</p>
<h4 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a>ExecutorService</h4><ul>
<li>åˆ›å»ºçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿèµ„æºï¼ˆçº¿ç¨‹èµ„æºã€æ ˆç©ºé—´â€¦ï¼‰</li>
<li>é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹éœ€è¦æ¶ˆè€—å¤§é‡æ—¶é—´</li>
</ul>
<p>çº¿ç¨‹æ± ï¼š</p>
<ul>
<li>çº¿ç¨‹æ± ç»´æŠ¤è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œå¤„äºç­‰å¾…çŠ¶æ€</li>
<li>å¦‚æœæœ‰æ–°ä»»åŠ¡ï¼Œå°±åˆ†é…ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ‰§è¡Œ</li>
<li>å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œæ–°ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ç­‰å¾…</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> String result;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// foo</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">4</span>);  <span class="comment">// å›ºå®šçº¿ç¨‹æ± å¤§å°</span></span><br><span class="line">executor.submit(<span class="keyword">new</span> PrintTask(<span class="string">"Bob"</span>));</span><br><span class="line">executor.submit(<span class="keyword">new</span> PrintTask(<span class="string">"Chuck"</span>))</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">executor.shutdown();</span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨çš„æ± ï¼š</p>
<ul>
<li>FixedThreadPoolï¼šçº¿ç¨‹æ•°å›ºå®š</li>
<li>CachedThreadPoolï¼šçº¿ç¨‹æ•°æ ¹æ®ä»»åŠ¡åŠ¨æ€è°ƒæ•´<ul>
<li>è®¾ç½®ä¸Šé™ï¼šnew ThreadPoolExecutor(0, 10, 60L, TimeUnit.SECONDS)</li>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ åˆå§‹å¤§å°</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ æœ€å¤§å¤§å°</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ keepAliveTime</li>
</ul>
</li>
<li>SingleThreadPoolï¼šä»…å•çº¿ç¨‹æ‰§è¡Œï¼ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰</li>
<li>ScheduledThreadPoolï¼šä¸€ä¸ªä»»åŠ¡å¯ä»¥å®šæœŸåå¤æ‰§è¡Œ<ul>
<li>Fixed Rateï¼ˆä¸ç®¡ä»»åŠ¡æ‰§è¡Œäº†å¤šä¹…ï¼Œåœæ­¢ï¼‰</li>
<li>Fixed Delayï¼ˆç­‰ä»»åŠ¡æ‰§è¡Œå®Œï¼‰</li>
</ul>
</li>
</ul>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/4t7ae.jpg" alt="" title="Fixed Rate å’Œ Fixed Delay çš„åŒºåˆ«"></p>
<p>java.util.Timer</p>
<ul>
<li>ä¸€ä¸ª Timer å¯¹åº”ä¸€ä¸ª Threadï¼ˆå¤šä¸ªä»»åŠ¡è¦å¤šä¸ª Timerï¼‰</li>
<li>å¿…é¡»åœ¨ä¸»çº¿ç¨‹ç»“æŸæ—¶è°ƒç”¨ Timer.cancel()</li>
</ul>
<h4 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> String result;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.result = longTimeCalculation();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">Task task1 = <span class="keyword">new</span> Task();</span><br><span class="line">executor.submit(task1); <span class="comment">// è¿™æ ·å°±å¯ä»¥æœ‰è¿”å›å€¼</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½¿ç”¨ JDK æä¾›çš„ Callable<t> æ¥å£ï¼š</t></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> longTimeCalculation();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="comment">// Future &lt;- Task (Callable)</span></span><br><span class="line">Callable&lt;String&gt; task = <span class="keyword">new</span> Task();</span><br><span class="line">ExecutorService executor = Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line">Future&lt;String&gt; future = executor.submit(task);</span><br><span class="line">String result = future.get(); <span class="comment">// å¯èƒ½ä¼šé˜»å¡</span></span><br></pre></td></tr></table></figure>
<p>Future<v>æ¥å£ï¼šè¡¨ç¤ºä¸€ä¸ªæœªæ¥å¯èƒ½ä¼šè¿”å›çš„ç»“æœã€‚</v></p>
<ul>
<li>get()     é˜»å¡æ–¹æ³•</li>
<li>get(long timeout, TimeUnit unit)</li>
<li>cancel(boolean mayInterruptIfRunning)</li>
<li>isDone()  è½®è¯¢</li>
</ul>
<h4 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; cf = getCompletableFutureFromSomewhere();</span><br><span class="line"><span class="comment">// cf = CompletableFuture.supplyAsync(å¼‚æ­¥æ‰§è¡Œå®ä¾‹)</span></span><br><span class="line"><span class="comment">// accept</span></span><br><span class="line">cf.thenAccept(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"æ­£å¸¸: "</span> + result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// exception</span></span><br><span class="line">cf.exceptionally(<span class="keyword">new</span> Function&lt;Throwable, String&gt;() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"å¼‚å¸¸: "</span> + t.getMessage());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// JDK 8 æ–°å¢</span></span><br><span class="line">CompletableFuture&lt;String&gt; cf = getCompletableFutureFromSomewhere();</span><br><span class="line"></span><br><span class="line">cf.thenAccept((result) -&gt; &#123;</span><br><span class="line">  <span class="comment">// ok</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// exception</span></span><br><span class="line">cf.exceptionally((t) -&gt; &#123;</span><br><span class="line">  <span class="comment">// bad</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è®°å¾—åœ¨æœ€åè¦åŠ <code>cf.join()</code>é˜²æ­¢ä¸»çº¿ç¨‹å…³é—­ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¼‚æ­¥ä»»åŠ¡ç»“æŸæ—¶ï¼Œä¼šè‡ªåŠ¨å›è°ƒæŸä¸ªå¯¹è±¡çš„æ–¹æ³•</li>
<li>å¼‚æ­¥ä»»åŠ¡å‡ºé”™æ—¶ï¼Œä¼šè‡ªåŠ¨å›è°ƒæŸä¸ªå¯¹è±¡çš„æ–¹æ³•</li>
<li>ä¸»çº¿ç¨‹è®¾ç½®å¥½å›è°ƒåï¼Œä¸å†å…³å¿ƒå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œ</li>
</ul>
<p>CompletableFuture å¯¹è±¡å¯ä»¥æŒ‡å®šå¼‚æ­¥å¤„ç†æµç¨‹ï¼š</p>
<ul>
<li>thenAccept()ï¼šå¤„ç†æ­£å¸¸ç»“æœ</li>
<li>exceptional()ï¼šå¤„ç†å¼‚å¸¸ç»“æœ</li>
<li>thenApplyAsync()ï¼šç”¨äºä¸²è¡ŒåŒ–å¦ä¸€ä¸ª CompletableFuture</li>
<li>anyOf() / allOf()ï¼šç”¨äºå¹¶è¡ŒåŒ–ä¸¤ä¸ª CompletableFuture</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; cf1 = CompletableFuture.supplyAsync(...);</span><br><span class="line">CompletableFuture&lt;LocalDate&gt; cf2 = cf1.thenApplyAsync(...);</span><br><span class="line">CompletableFuture&lt;Float&gt; cf3 = cf2.thenApplyAsync(...);</span><br><span class="line">cf3.thenAccept(...);</span><br></pre></td></tr></table></figure>
<p>CompletableFuture çš„å‘½åè§„åˆ™ï¼š</p>
<ul>
<li>xxx()ï¼šç»§ç»­åœ¨å·²æœ‰çš„çº¿ç¨‹ä¸­æ‰§è¡Œ</li>
<li>xxxAsync()ï¼šç”¨ Executor çš„æ–°çº¿ç¨‹æ‰§è¡Œ</li>
</ul>
<h4 id="Fork-Join"><a href="#Fork-Join" class="headerlink" title="Fork / Join"></a>Fork / Join</h4><p>Fork / Join çº¿ç¨‹æ± å¯ä»¥æ‰§è¡Œä¸€ç§ç‰¹æ®Šçš„ä»»åŠ¡ï¼š</p>
<ul>
<li>æŠŠä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°äººç‰©å¹¶è¡Œæ‰§è¡Œ</li>
<li>JDK &gt;= 1.7</li>
<li>æ¯”å¦‚è®¡ç®—ä¸€ä¸ªå¤§æ•°ç»„çš„å’Œ</li>
</ul>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/asx6a.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœç»§æ‰¿ RecursiveAction æ˜¯æ²¡æœ‰è¿”å›å€¼çš„</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SumTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THRESHOLD = <span class="number">500</span>; <span class="comment">// å¯ä»¥è®¾ç½®é˜ˆå€¼</span></span><br><span class="line">  <span class="keyword">long</span>[] array;</span><br><span class="line">  <span class="keyword">int</span> start;</span><br><span class="line">  <span class="keyword">int</span> end;</span><br><span class="line">  </span><br><span class="line">  SumTask(<span class="keyword">long</span>[] array, <span class="keyword">int</span> start, <span class="keyword">int</span> end) &#123;</span><br><span class="line">    <span class="keyword">this</span>.array = array;</span><br><span class="line">    <span class="keyword">this</span>.start = start;</span><br><span class="line">    <span class="keyword">this</span>.end = end;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> Long <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (? &lt;= THRESHOLD) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—</span></span><br><span class="line">      <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i + end; i++) &#123;</span><br><span class="line">        sum += <span class="keyword">this</span>.array[i];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          Thread.sleep(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> sum;   <span class="comment">// è‡ªåŠ¨è£…ç®±</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»»åŠ¡å¤ªå¤§ï¼Œä¸€åˆ†ä¸ºäºŒ</span></span><br><span class="line">    <span class="keyword">int</span> middle = (end + start) / <span class="number">2</span>;</span><br><span class="line">    SumTask subtask1 = <span class="keyword">new</span> SumTask(<span class="keyword">this</span>.array, start, middle);</span><br><span class="line">    SumTask subtask2 = <span class="keyword">new</span> SumTask(<span class="keyword">this</span>.array, middle, end);</span><br><span class="line">    invokeAll(subtask1, subtask2);</span><br><span class="line">    Long result1 = subtask1.join();</span><br><span class="line">    Long result2 = subtask2.join();</span><br><span class="line">    <span class="keyword">return</span> result1 + result2;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="keyword">long</span>[] array = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">1000</span>];</span><br><span class="line"><span class="comment">// fork / join</span></span><br><span class="line">ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> SumTask(array, <span class="number">0</span>, array.length);</span><br><span class="line">Long result = ForkJoinPool.commonPool().invoke(task);</span><br></pre></td></tr></table></figure>
<h3 id="çº¿ç¨‹å·¥å…·-ThreadLocal"><a href="#çº¿ç¨‹å·¥å…·-ThreadLocal" class="headerlink" title="çº¿ç¨‹å·¥å…· ThreadLocal"></a>çº¿ç¨‹å·¥å…· ThreadLocal</h3><p>Thread.currentThread() è·å–å½“å‰çº¿ç¨‹ã€‚</p>
<p>å¦‚ä½•åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¼ é€’çŠ¶æ€ï¼Ÿ</p>
<p>JDK æä¾› ThreadLocalï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> ThreadLocal&lt;String&gt; threadLocalUser = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">threadLocalUser.set(<span class="string">"Bob"</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">String current = threadLocalUser.get();</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">threadLocalUser.remove();</span><br></pre></td></tr></table></figure>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/w6fzw.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  <span class="keyword">int</span> level;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.level = level;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserContext</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;User&gt; context = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">getCurrentUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> context.get();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserContext</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    context.set(user);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    context.remove();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  User user;</span><br><span class="line">  </span><br><span class="line">  ProcessThread(User user) &#123;</span><br><span class="line">    <span class="keyword">this</span>.user = user;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (UserContext ctx = <span class="keyword">new</span> UserContext(user)) &#123;</span><br><span class="line">      <span class="comment">// step 1</span></span><br><span class="line">      <span class="keyword">new</span> Greeting().hello();</span><br><span class="line">      <span class="comment">// step 2</span></span><br><span class="line">      Level.checkLevel();</span><br><span class="line">      <span class="comment">// step 3</span></span><br><span class="line">      <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    User user = UserContext.getCurrentUser();</span><br><span class="line">    <span class="comment">// print</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Level</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = UserContext.getCurrentUser();</span><br><span class="line">    <span class="keyword">if</span> (user.level &gt; <span class="number">100</span>) &#123;</span><br><span class="line">      <span class="comment">// print</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// print</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">Thread t1 = <span class="keyword">new</span> ProcessThread(<span class="string">"Chuck"</span>, <span class="number">500</span>);</span><br><span class="line">Thread t2 = <span class="keyword">new</span> ProcessThread(<span class="string">"Nano"</span>, <span class="number">1200</span>);</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">t1.join();</span><br><span class="line">t2.join();</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æŠŠ ThreadLocal çœ‹æˆå…¨å±€ Map<thread, object="">ï¼Œæ¯ä¸ªçº¿ç¨‹è·å– ThreadLocal å˜é‡æ—¶ï¼Œä½¿ç”¨ Thread æœ¬èº«ä½œä¸º keyã€‚</thread,></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object threadLocalValue = threadLocalMap.get(Thread.currentThread());</span><br></pre></td></tr></table></figure>
<p>ThreadLocal é€‚åˆåœ¨ä¸€ä¸ªçº¿ç¨‹çš„å¤„ç†æµç¨‹ä¸­ä¿æŒä¸Šä¸‹æ–‡ï¼ˆé¿å…äº†åŒä¸€å‚æ•°åœ¨æ‰€æœ‰æ–¹æ³•ä¸­ä¼ é€’ï¼‰ã€‚ä½¿ç”¨ ThreadLocal è¦ç”¨ <code>try ... finally</code>ï¼Œæˆ–è€…<code>try() { ... }</code>ã€‚è€Œä¸”ï¼Œä½¿ç”¨<code>try ... finally</code>ä¸€å®šè¦å† finally ä¸­æ¸…é™¤ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  UserContext.set(user);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  UserContext.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Maven-åŸºç¡€"><a href="#Maven-åŸºç¡€" class="headerlink" title="Maven åŸºç¡€"></a>Maven åŸºç¡€</h2><p>ä»‹ç»ä½œä¸ºä½¿ç”¨æœ€å¹¿æ³›çš„ Java é¡¹ç›®ç®¡ç†å·¥å…·çš„ Maven çš„åŸºæœ¬ç”¨æ³•ï¼Œç†è§£å¹¶ä½¿ç”¨ Maven çš„ä¾èµ–ç®¡ç†ã€æ„å»ºæµç¨‹ã€æ’ä»¶åŠæ¨¡å—åŒ–ç®¡ç†ã€‚</p>
<h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><h4 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ä¸€ä¸ª Java é¡¹ç›®ï¼š</p>
<ul>
<li>ä¾èµ–åŒ…ç®¡ç†ï¼ˆcommons-logging -&gt; log4jï¼‰</li>
<li><p>é¡¹ç›®ç»“æ„</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">project</span><br><span class="line">+- src</span><br><span class="line">| +- resources</span><br><span class="line">+- bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®ç¯å¢ƒ</p>
</li>
<li>ç¼–è¯‘æ‰“åŒ…æµç¨‹</li>
<li>ç‰ˆæœ¬ç®¡ç†</li>
<li>å‘½ä»¤è¡Œå·¥å…·</li>
</ul>
<p>Maven æ˜¯ä¸€ä¸ª Java é¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…·ï¼š</p>
<ul>
<li>æ ‡å‡†åŒ–é¡¹ç›®ç»“æ„</li>
<li>æ ‡å‡†åŒ–æ„å»ºæµç¨‹ï¼ˆç¼–è¯‘ã€æ‰“åŒ…ã€å‘å¸ƒâ€¦ï¼‰</li>
<li>ä¾èµ–ç®¡ç†</li>
</ul>
<p>é¡¹ç›®ç»“æ„ï¼ˆåƒä¸‡ä¸è¦éšæ„ä¿®æ”¹ç»“æ„ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a-maven-project</span><br><span class="line">+- src</span><br><span class="line">| +- main</span><br><span class="line">|   +- java       Java æºç </span><br><span class="line">|   +- resources  èµ„æºæ–‡ä»¶</span><br><span class="line">| +- test</span><br><span class="line">|   +- java        Java æµ‹è¯•æºç </span><br><span class="line">|   +- resources   æµ‹è¯•èµ„æºæ–‡ä»¶</span><br><span class="line">+- target     ç¼–è¯‘è¾“å‡º</span><br><span class="line">+- pom.xml    é¡¹ç›®æè¿°æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<p>åœ¨ Maven ä¸­å£°æ˜ä¸€ä¸ªä¾èµ–é¡¹å¯ä»¥è‡ªåŠ¨ä¸‹è½½å¹¶å¯¼å…¥ classpathï¼›Maven ä½¿ç”¨ groupIdã€artifactId å’Œ version å”¯ä¸€å®šä½ä¸€ä¸ª jar åŒ…ã€‚</p>
<p>æ™®é€šçš„ Java é¡¹ç›® pom.xml ç»“æ„ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/kmox5.jpg" alt="" title="pom.xml çš„åŸºæœ¬ç»“æ„"></p>
<p>Group Idï¼šåŸŸåï¼Œå¦‚ com.mycompanyã€‚<br>Artifact Idï¼šé¡¹ç›®åï¼Œå¦‚ helloworldã€‚</p>
<p>ä¿®æ”¹é¡¹ç›® JDKã€ç¼–è¯‘å™¨ç­‰ç‰ˆæœ¬ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h4><p>ä¼ ç»Ÿæ–¹æ³•ï¼šæœç´¢å¼•æ“ - æ‰‹åŠ¨ä¸‹è½½ - è§£å‹ - æ”¾å…¥ classpath</p>
<p>Maven è§£å†³äº†ä¾èµ–ç®¡ç†é—®é¢˜ï¼ˆSample é¡¹ç›® -&gt; abc -&gt; xyzï¼‰ï¼š</p>
<p>Maven ä¼šè‡ªåŠ¨å¯¼å…¥ abcï¼Œåˆä¼šè‡ªåŠ¨å¯¼å…¥ xyzã€‚</p>
<p>Maven çš„ä¾èµ–å…³ç³»ç±»å‹ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/u02da.jpg" alt="" title="ä¾èµ–å…³ç³»ç±»å‹"></p>
<p>Maven ä»ä½•ä¸‹è½½æ‰€éœ€çš„ä¾èµ–ï¼Ÿ</p>
<ul>
<li>Maven ç»´æŠ¤äº†ä¸€ä¸ªä¸­å¤®ä»“åº“ï¼ˆrepo1.maven.orgï¼‰</li>
<li>ç¬¬ä¸‰æ–¹åº“å°†è‡ªèº«ä¸Šä¼ è‡³ä¸­å¤®ä»“åº“</li>
<li>Maven ä»ä¸­å¤®ä»“åº“æŠŠæ‰€éœ€ä¾èµ–ä¸‹è½½åˆ°æœ¬åœ°</li>
<li>Maven ä¼šè‡ªåŠ¨ç¼“å­˜å·²ä¸‹è½½çš„ jar åŒ…ï¼ˆ~/.m2/repositoryï¼‰</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Maven é•œåƒä»“åº“ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/tmhv9.jpg" alt="" title="Maven é•œåƒä»“åº“"></p>
<p>åœ¨<code>~/.m2/settings.xml</code>é…ç½® Maven é•œåƒä»“åº“ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">usl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirros</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="æ„å»ºæµç¨‹"><a href="#æ„å»ºæµç¨‹" class="headerlink" title="æ„å»ºæµç¨‹"></a>æ„å»ºæµç¨‹</h4><ul>
<li>cleanï¼ˆåˆ é™¤æ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ï¼‰</li>
<li>compileï¼ˆç¼–è¯‘æºç ã€ç¼–è¯‘æµ‹è¯•æºç ï¼‰</li>
<li>testï¼ˆè¿è¡Œæµ‹è¯•ï¼‰</li>
<li>packageï¼ˆæ‰“åŒ…ä¸º jar / warï¼‰</li>
</ul>
<p>Maven çš„ç”Ÿå‘½å‘¨æœŸï¼ˆlifecycleï¼‰ç”±ä¸€ç³»åˆ—é˜¶æ®µï¼ˆphaseï¼‰æ„æˆï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/y6tuo.jpg" alt="" title="Maven çš„ç”Ÿå‘½å‘¨æœŸ"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn compile</span><br><span class="line">mvn clean test  # å°†æ‰§è¡Œ cleanã€compileã€testï¼Œå› ä¸º test ä¾èµ– compile</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¸€ä¸ª Phase å®é™…ä¸Šæ˜¯æ‰§è¡Œäº†ä¸€ç³»åˆ— Goal ç›´åˆ°è¯¥ Phase ä¸ºæ­¢ã€‚</p>
<p>å¦‚æ‰§è¡Œï¼šmvn compileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validate -&gt; initialize -&gt; generate-sources -&gt; process-sources -&gt; generate-resources -&gt; process-resources -&gt; compile</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¸€ä¸ª Phase åˆä¼šè§¦å‘ä¸€ä¸ªæˆ–å¤šä¸ª Goalï¼ŒGoal æ˜¯æœ€å°æ‰§è¡Œä»»åŠ¡å•å…ƒï¼š</p>
<ul>
<li>compile -&gt; compiler:compile</li>
<li>test -&gt; compiler:testCompileã€surefile:test</li>
</ul>
<p>å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å·²åœ¨ pom.xml æ‰€åœ¨ç›®å½•</span></span><br><span class="line">mvn clean compile</span><br><span class="line">mvn test</span><br><span class="line">mvn compiler:copmile</span><br><span class="line">mvn clean package # æœ€å¸¸ç”¨ï¼šç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ… jar åŒ…</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½†å®ƒä¸ä¼šæ‰“åŒ…ä¾èµ–çš„ jar åŒ…</span></span><br></pre></td></tr></table></figure>
<h3 id="è¿›é˜¶-1"><a href="#è¿›é˜¶-1" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><h4 id="ä½¿ç”¨æ’ä»¶"><a href="#ä½¿ç”¨æ’ä»¶" class="headerlink" title="ä½¿ç”¨æ’ä»¶"></a>ä½¿ç”¨æ’ä»¶</h4><p>Maven é€šè¿‡è°ƒç”¨ä¸åŒçš„æ’ä»¶ï¼ˆPluginï¼‰æ¥æ„å»ºé¡¹ç›®ï¼Œå¦‚ mvn compile å®é™…ä¸Šæ˜¯æ‰§è¡Œ compiler æ’ä»¶ã€‚</p>
<ul>
<li>clean æ’ä»¶ï¼ˆcleanï¼‰</li>
<li>compiler æ’ä»¶ï¼ˆcompileï¼‰</li>
<li>surefire æ’ä»¶ï¼ˆtestï¼‰</li>
<li>jar æ’ä»¶ï¼ˆpackageï¼‰</li>
</ul>
<p>è‡ªå®šä¹‰æ’ä»¶è¦å£°æ˜ï¼ˆå¦‚ maven-shade-pluginï¼‰ã€‚</p>
<p>å¸¸ç”¨æ’ä»¶ï¼š</p>
<ul>
<li>maven-shade-pluginï¼šæ‰“åŒ…æ‰€æœ‰ä¾èµ–åŒ…å¹¶ç”Ÿæˆå¯æ‰§è¡Œ jar</li>
<li>cobertura-maven-pluginï¼šç”Ÿæˆå•å…ƒæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š</li>
<li>findbugs-maven-pluginï¼šå¯¹ Java æºç è¿›è¡Œé™æ€åˆ†æä»¥æ‰¾å‡ºæ½œåœ¨é—®é¢˜</li>
</ul>
<h4 id="æ¨¡å—ç®¡ç†"><a href="#æ¨¡å—ç®¡ç†" class="headerlink" title="æ¨¡å—ç®¡ç†"></a>æ¨¡å—ç®¡ç†</h4><p>æŠŠå¤§é¡¹ç›®æ‹†åˆ†ä¸ºæ¨¡å—æ˜¯é™ä½è½¯ä»¶å¤æ‚åº¦çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/n5q8r.jpg" alt="" title="æ¨¡å—åŒ–"></p>
<p>å¦‚æœæ¨¡å— A å’Œæ¨¡å— B çš„ pom.xml é«˜åº¦ç›¸ä¼¼ï¼Œå¯ä»¥æå–å‡ºå…±åŒéƒ¨åˆ†ä½œä¸º parentã€‚</p>
<p>Maven æœ‰ä¸­å¤®ä»“åº“ã€ç§æœ‰ä»“åº“ã€æœ¬åœ°ä»“åº“ã€‚</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/ms3si.jpg" alt="" title="æœ¬åœ°ä»“åº“"></p>
<p>ä½†ä¸æ¨èã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>&lt;moduels&gt;</code>ç¼–è¯‘å¤šä¸ªæ¨¡å—ã€‚</p>
<p>åœ¨ IntelliJ IDEA ä¸­ Project æ˜¯æœ€é¡¶çº§çš„çº§åˆ«ï¼Œæ¬¡çº§åˆ«æ˜¯ Moduleã€‚ä¸€ä¸ª Project å¯ä»¥æœ‰å¤šä¸ª Moduleã€‚ç›®å‰ä¸»æµçš„å¤§å‹é¡¹ç›®ç»“æ„éƒ½æ˜¯ç±»ä¼¼è¿™ç§å¤š Module ç»“æ„ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„é¡¹ç›®å¯ä»¥åˆ’åˆ†ä¸º helloworld-appã€helloworld-utilsã€helloworld-model ç­‰ç­‰ï¼ŒModule ä¹‹é—´å¯ä»¥äº’ç›¸ä¾èµ–ã€‚è€Œ Project æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼ŒProject ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªModule ç»„æˆã€‚Project è·Ÿ Module ä¹‹é—´çš„å…³ç³»ç”± pom.xml æ¥é…ç½®ï¼ŒModule ä¹‹é—´çš„ä¾èµ–ç”± Module æ–‡ä»¶å¤¹ä¸­çš„ pom.xml æ¥é…ç½®ã€‚</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé¡¹ç›®éƒ½åªæœ‰ä¸€ä¸ª Module æ„æˆï¼Œéœ€è¦è¿›è¡Œåˆ†å±‚éƒ½ä¼šé€šè¿‡ package æ¥å®Œæˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">project -&gt; module -&gt; package -&gt; class -&gt; method</span><br></pre></td></tr></table></figure>
<h2 id="JDBC-åŸºç¡€"><a href="#JDBC-åŸºç¡€" class="headerlink" title="JDBC åŸºç¡€"></a>JDBC åŸºç¡€</h2><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>JDBCï¼šJava DataBase Connectivity</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/1eh13.jpg" alt="" title="JDBC åº•å±‚å…³ç³»"></p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String JDBC_URL = <span class="string">"jbc:mysql://localhost:3306/test"</span>;</span><br><span class="line">String JDBC_USER = <span class="string">"root"</span>;</span><br><span class="line">String JDBC_PASSWORD = <span class="string">"password"</span>;</span><br><span class="line">Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD);</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ JDBC çš„å¥½å¤„ï¼š</p>
<ul>
<li>å„æ•°æ®åº“å‚å•†ä½¿ç”¨ç›¸åŒçš„æ¥å£ï¼ŒJava ä»£ç ä¸éœ€è¦é’ˆå¯¹ä¸åŒæ•°æ®åº“å¼€å‘ã€‚</li>
<li>Java ç¨‹åºç¼–è¯‘å™¨ä»…ä¾èµ– java.sql.*ï¼Œä¸ä¾èµ–å…·ä½“æ•°æ®åº“çš„ jar åŒ…ã€‚</li>
<li>å¯éšæ—¶æ›¿æ¢åº•å±‚æ•°æ®åº“ï¼Œè®¿é—®æ•°æ®åº“çš„ Java ä»£ç ä¸å˜ã€‚</li>
</ul>
<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(JDBC_URL, JDBC_USER, JDBC_PASSWORD)) &#123;</span><br><span class="line">  <span class="keyword">try</span> (Statement stmt = conn.createStatement()) &#123;</span><br><span class="line">    <span class="keyword">try</span> (ResultSet rs = stmt.executeQuery(<span class="string">"SELECT * FROM students WHERE gender=\'M\'"</span>)) &#123;</span><br><span class="line">      <span class="keyword">while</span> (rs.next) &#123;</span><br><span class="line">        <span class="keyword">long</span> id = rs.getLong(<span class="number">1</span>); <span class="comment">// æ³¨æ„æ˜¯ä» 1 å¼€å§‹</span></span><br><span class="line">        <span class="keyword">long</span> classId = rs.getLong(<span class="number">2</span>);</span><br><span class="line">        String name = rs.getString(<span class="number">3</span>);</span><br><span class="line">        String gender = rs.getString(<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†é¿å… SQL æ³¨å…¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬æœ€å¥½ä½¿ç”¨ PreparedStatementã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">User <span class="title">login</span><span class="params">(String name, String pass)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  PreparedStatement ps = conn.prepareStatement(<span class="string">"SELECT * FROM user WHERE login=? AND pass=?"</span>);</span><br><span class="line">  ps.setObject(<span class="number">1</span>, name);</span><br><span class="line">  ps.setObject(<span class="number">2</span>, pass);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ›´æ–°-amp-æ’å…¥"><a href="#æ›´æ–°-amp-æ’å…¥" class="headerlink" title="æ›´æ–° &amp; æ’å…¥"></a>æ›´æ–° &amp; æ’å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›´æ–°</span></span><br><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(...)) &#123;</span><br><span class="line">  <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(<span class="string">"UPDATE students SET name=? WHERE id=?"</span>)) &#123;</span><br><span class="line">    ps.setObject(<span class="number">1</span>, <span class="string">"Bob"</span>);</span><br><span class="line">    ps.setObject(<span class="number">2</span>, <span class="number">999</span>);</span><br><span class="line">    <span class="keyword">int</span> n = ps.executeUpdate();  <span class="comment">// è¿”å›ç¬¦åˆæ¡ä»¶çš„æ›´æ–°çš„è®°å½•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥å¹¶è·å–ä¸»é”®</span></span><br><span class="line"><span class="keyword">try</span> (Connection conn = DriverManager.getConnection(...)) &#123;</span><br><span class="line">  <span class="keyword">try</span> (PreparedStatement ps = conn.prepareStatement(<span class="string">"INSERT INTO students (class_id, name, gender) VALUES (?,?,?)"</span>, Statement.RETURN_GENERATED_KEYS)) &#123;</span><br><span class="line">    ps.setObject(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    ps.setObject(<span class="number">2</span>, <span class="string">"Bob"</span>);</span><br><span class="line">    ps.setObject(<span class="number">3</span>, <span class="string">"M"</span>);</span><br><span class="line">    <span class="keyword">int</span> n = ps.executeUpdate();</span><br><span class="line">    <span class="keyword">try</span> (Result rs = ps.getGenerateKeys()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">        <span class="keyword">long</span> id = rs.getLong(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p>æ•°æ®åº“äº‹åŠ¡ï¼ˆTransactionï¼‰å…·æœ‰ ACID ç‰¹æ€§ï¼š</p>
<ul>
<li>Atomicity åŸå­æ€§</li>
<li>Consistency ä¸€è‡´æ€§</li>
<li>Isolation éš”ç¦»æ€§</li>
<li>Durability æŒä¹…æ€§</li>
</ul>
<p>é—®é¢˜ï¼š</p>
<ul>
<li>è„è¯»ï¼šDirty Read</li>
<li>éé‡å¤è¯»ï¼šNon-repeatable Read</li>
<li>å¹»è¯»ï¼šPhantom Read</li>
</ul>
<p>äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/k6q90.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">conn = openConnection();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">  <span class="comment">// æ‰§è¡Œå¤šæ¡ SQL è¯­å¥</span></span><br><span class="line">  insert(); update(); delete();</span><br><span class="line">  conn.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">  conn.rollback();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  conn.setAutoCommit(<span class="keyword">true</span>);</span><br><span class="line">  conn.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h2 id="å‡½æ•°å¼ç¼–ç¨‹"><a href="#å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹"></a>å‡½æ•°å¼ç¼–ç¨‹</h2><p>ä»‹ç» Java å‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programmingï¼‰çš„åŸºæœ¬æ¦‚å¿µï¼Œå¦‚ä½•ä½¿ç”¨ lambda è¡¨è¾¾å¼å’Œ stream æ•°æ®æµã€‚</p>
<h3 id="Lambda-åŸºç¡€"><a href="#Lambda-åŸºç¡€" class="headerlink" title="Lambda åŸºç¡€"></a>Lambda åŸºç¡€</h3><p>å‡½æ•°å¼ç¼–ç¨‹ï¼š</p>
<ul>
<li>æŠŠå‡½æ•°ä½œä¸ºåŸºæœ¬è¿ç®—å•ä½</li>
<li>å‡½æ•°å¯ä»¥ä½œä¸ºå˜é‡</li>
<li>å‡½æ•°å¯ä»¥æ¥æ”¶å‡½æ•°</li>
<li>å‡½æ•°å¯ä»¥è¿”å›å‡½æ•°</li>
</ul>
<p>å†å²ä¸Šç ”ç©¶å‡½æ•°å¼ç¼–ç¨‹çš„è¢«ç§°ä¸º<code>Î» æ¼”ç®—</code>ï¼ˆLambdaï¼‰ã€‚</p>
<p>Java ä¸­ï¼ŒLambda è¡¨è¾¾å¼çš„å¼•ç”¨æ˜¯ä¸ºäº†ç®€åŒ–è¯­æ³•ï¼Œç±»å‹è‡ªåŠ¨æ¨æ–­ã€‚ï¼ˆJDK &gt;= 1.8ï¼‰</p>
<p>ä¼ ç»Ÿçš„åŒ¿åç±»æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(array, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Lambda æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(array, (s1, s2) -&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Java çš„å•æ–¹æ³•æ¥å£ï¼ˆå‡½æ•°å¼æ¥å£ï¼‰ï¼šComparatorã€Runnableã€Callableã€‚</p>
<p>å•æ–¹æ³•æ¥å£å¯ä»¥è¢«æ ‡æ³¨ä¸º @FuntionalInterfaceï¼Œå³<code>å‡½æ•°å¼æ¥å£</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// default å’Œ static æ–¹æ³•ä¸æ˜¯æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T o1, T o2)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">default</span> Comparator&lt;T&gt; <span class="title">reversed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Collections.reverseOrder(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function">Comparator&lt;T&gt; <span class="title">reverseOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Collections.reverseOrder();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•å¼•ç”¨ï¼ˆMethod-Referenceï¼‰"><a href="#æ–¹æ³•å¼•ç”¨ï¼ˆMethod-Referenceï¼‰" class="headerlink" title="æ–¹æ³•å¼•ç”¨ï¼ˆMethod Referenceï¼‰"></a>æ–¹æ³•å¼•ç”¨ï¼ˆMethod Referenceï¼‰</h3><p>æ–¹æ³•å¼•ç”¨ï¼šå¦‚æœæŸä¸ª<code>æ–¹æ³•ç­¾å</code>å’Œæ¥å£æ°å¥½ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥æ–¹æ³•å¼•ç”¨ï¼Œå¦‚ String::compareToã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(array, (s1, s2) -&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Arrays.sort(array, String::compareTo);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ–¹æ³•ç­¾å<code>åªçœ‹è¿”å›å€¼å’Œå‚æ•°ç±»å‹</code>ã€‚</p>
<p>é™æ€æ–¹æ³•å¼•ç”¨ï¼šåŒå®ä¾‹æ–¹æ³•å¼•ç”¨ã€‚</p>
<p><strong>æ³¨æ„å®ä¾‹æ–¹æ³•çš„ä»¥ä¸‹æƒ…å†µï¼š</strong></p>
<p>å®ä¾‹æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å…¶å®æ˜¯ thisã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareToIgnoreCase</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Arrays.sort(array, String::compareToIgnoreCase);</span><br><span class="line"><span class="comment">// =&gt; instance.compareToIgnoreCase(s) </span></span><br><span class="line"><span class="comment">//     -&gt; instance =&gt; compare(instance, s) =&gt; compare(this, s)</span></span><br><span class="line"><span class="comment">// å› æ­¤ï¼Œè¿™ä¸ªæ–¹æ³•å¼•ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå’Œæ¥å£ä¸€è‡´ã€‚</span></span><br><span class="line"><span class="comment">// =&gt; Comparator.compare(instance, s)</span></span><br></pre></td></tr></table></figure>
<p>æ„é€ æ–¹æ³•å¼•ç”¨ï¼š</p>
<p>map() ä¼ å…¥çš„æ–¹æ³•ç­¾åæ˜¯ï¼šPerson method(String)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">"Bob"</span>, <span class="string">"Alice"</span>, <span class="string">"Tim"</span>);</span><br><span class="line">List&lt;Person&gt; persons = names.stream()</span><br><span class="line">                            .map(Person::<span class="keyword">new</span>)</span><br><span class="line">                            .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ„é€ æ–¹æ³•ã€‚æ³¨æ„ï¼Œè™½ç„¶ Java æ„é€ æ–¹æ³•ä¸èƒ½æœ‰ return<br>è¯­å¥ï¼Œä½†å®é™…ä¸Šå®ƒè¿”å›çš„å€¼æ˜¯ thisã€‚</p>
<p>Functional Interface å¯ä»¥ä¼ å…¥ï¼š</p>
<ul>
<li>æ¥å£çš„å®ç°ç±»ï¼ˆä»£ç æ¯”è¾ƒç¹çï¼‰</li>
<li>Lambda è¡¨è¾¾å¼</li>
<li>ç¬¦åˆæ–¹æ³•ç­¾åçš„é™æ€æ–¹æ³•</li>
<li>ç¬¦åˆæ–¹æ³•ç­¾åçš„å®ä¾‹æ–¹æ³•ï¼ˆå®ä¾‹ç±»å‹è¢«çœ‹åšç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹ï¼‰</li>
<li>ç¬¦åˆæ–¹æ³•ç­¾åçš„æ„é€ æ–¹æ³•ï¼ˆå®ä¾‹ç±»å‹è¢«çœ‹åšè¿”å›ç±»å‹ï¼‰</li>
</ul>
<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><h4 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Java 8 å¼•å…¥äº†å…¨æ–°çš„ Stream APIï¼šjava.util.streamã€‚</p>
<p>å…¶ä¸åŒäº java.io çš„ InputStream / OutputStreamï¼š</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/0ppro.jpg" alt="" title="java.io VS. java.util.stream"></p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/kw9qz.jpg" alt="" title="java.util.List VS. java.util.stream"></p>
<p>Stream çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¯ä»¥â€œå­˜å‚¨â€æœ‰é™ä¸ªæˆ–æ— é™ä¸ªå…ƒç´ </li>
<li>å¯ä»¥è½¬æ¢ä¸ºå¦ä¸€ä¸ª Stream</li>
<li>è®¡ç®—é€šå¸¸å‘ç”Ÿåœ¨æœ€åç»“æœçš„è·å–ï¼ˆæƒ°æ€§è®¡ç®—ï¼‰</li>
</ul>
<h4 id="åˆ›å»º-Stream"><a href="#åˆ›å»º-Stream" class="headerlink" title="åˆ›å»º Stream"></a>åˆ›å»º Stream</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; s = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); <span class="comment">// å¯å˜å‚æ•°</span></span><br><span class="line">Stream&lt;Integer&gt; s = Arrays.stream(theArray);</span><br><span class="line">Stream&lt;Integer&gt; s = aList.stream();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®é™…ä¿å­˜çš„æ˜¯ç®—æ³•ï¼Œå¯ä»¥è¡¨ç°æ— é™åºåˆ—</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NaturalSupplier</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">BigInteger</span>&gt; </span>&#123;</span><br><span class="line">  BigInteger next = BigInteger.ZERO;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BigInteger <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    next = next.add(BigInteger.ONE);</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Stream&lt;BigInteger&gt; s = Stream.generate(<span class="keyword">new</span> NaturalSupplier());</span><br><span class="line"><span class="comment">// Stream&lt;T&gt; s = Stream.generate(Supplier&lt;T&gt; s);</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œå¦‚ä¸Š Stream å­˜åœ¨é—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­»å¾ªç¯</span></span><br><span class="line">s.forEach(System.out::println);</span><br><span class="line"><span class="comment">// éœ€è¦å°†æ— é™åºåˆ—å˜æˆæœ‰é™åºåˆ—</span></span><br><span class="line">s.limit(<span class="number">100</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String[] array = <span class="string">"JDK Stream API supports funtional-style operations"</span>.split(<span class="string">" "</span>);</span><br><span class="line"><span class="comment">// array -&gt; stream</span></span><br><span class="line"><span class="keyword">long</span> n = Arrays.stream(array)</span><br><span class="line">     .filter((s) -&gt; s.eqauls(s.toUpperCase()))</span><br><span class="line">     .count();</span><br><span class="line">System.out.println(<span class="string">"How many words? "</span> + n);</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰å¾ˆå¤šæ–¹æ³•è¿”å› Streamï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (Stream&lt;String&gt; lines = Files.lines(Paths.get(<span class="string">"/path/to/access.og"</span>))) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String input = <span class="string">"a, b, c, dd, E, ff"</span>;</span><br><span class="line">Pattern pattern = Pattern.compile(<span class="string">"\\s*\\,\\s*"</span>);</span><br><span class="line">Stream&lt;String&gt; s = pattern.splitAsStream(input);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºåŸºæœ¬ç±»å‹çš„ Stream</span></span><br><span class="line">Stream&lt;<span class="keyword">int</span>&gt; s;  <span class="comment">// compile error!</span></span><br><span class="line">IntStream is = IntStream.generate(IntSupplier s);</span><br><span class="line">LongStream ls = LongStream.generate(LongSupplier s);</span><br><span class="line">DoubleStream ds = DoubleStream.generate(DoubleSupplier s);</span><br></pre></td></tr></table></figure>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>Stream.map() æ˜¯ä¸€ä¸ª Stream çš„è½¬æ¢æ–¹æ³•ï¼ŒæŠŠä¸€ä¸ª Stream è½¬æ¢ä¸ºå¦ä¸€ä¸ª Streamã€‚</p>
<p><img src="https://bloggg-1254259681.cos.na-siliconvalley.myqcloud.com/d3cgm.jpg" alt="" title="map"></p>
<p>Stream.map()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„ T æ˜¯ Strema å£°æ˜çš„æ³›å‹å‚æ•°</span></span><br><span class="line"><span class="comment">// class Stream&lt;T&gt; &#123;</span></span><br><span class="line"><span class="comment">// ... ??? super, extends</span></span><br><span class="line">&lt;R&gt; <span class="function">Stream&lt;R&gt; <span class="title">map</span><span class="params">(Function_Foo&lt;? <span class="keyword">super</span> T, ? extends R&gt; mapper)</span></span>;</span><br><span class="line"><span class="comment">// T -&gt; R</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function_Foo</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// å°† T ç±»å‹è½¬æ¢ä¸º R ç±»å‹</span></span><br><span class="line">  <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; s1 = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">Stream&lt;Integer&gt; s2 = s1.map((n) -&gt; n * n);</span><br><span class="line"></span><br><span class="line">String[] array = <span class="string">"Stream API supports functional-style operation"</span>.split();</span><br><span class="line">Stream&lt;String&gt; sm = Arrays.stream(array);</span><br><span class="line">sm.map(String::toUpperCase).forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String[] inputs = &#123; <span class="string">"Bob,M"</span>, <span class="string">"Alice,F"</span>, <span class="string">"Time,M"</span> &#125;;</span><br><span class="line">Stream&lt;String&gt; names = Arrays.stream(inputs);</span><br><span class="line">Stream&lt;Person&gt; persons = names.map((s) -&gt; &#123;</span><br><span class="line">  <span class="keyword">int</span> n = s.indexOf(<span class="string">','</span>);</span><br><span class="line">  String name = s.substring(<span class="number">0</span>, n);</span><br><span class="line">  <span class="keyword">char</span> gender = s.charAt(n + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Person(name, gender);</span><br><span class="line">&#125;);</span><br><span class="line">persons.forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>å¯¹æ‰€æœ‰å…ƒç´ è¿›è¡Œæµ‹è¯•ï¼Œä¸æ»¡è¶³çš„å…ƒç´ å°±è¢«è¿‡æ»¤æ‰äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">filter</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> T&gt; predicate)</span></span>; <span class="comment">// ????</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><p>reduce æ˜¯èšåˆæ–¹æ³•ï¼Œå¦‚ count() è¿”å›å…ƒç´ ä¸ªæ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Optional&lt;T&gt; <span class="title">reduce</span><span class="params">(BinaryOperator&lt;T&gt; accumulator)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BinaryOperator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">BiFunction</span>&lt;<span class="title">T</span>, <span class="title">T</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Bi æ“ä½œï¼šä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè¾“å‡º</span></span><br><span class="line">    <span class="function">T <span class="title">apply</span><span class="params">(T t, T u)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>).reduce((acc, n) -&gt; acc + n); <span class="comment">// è¿”å›çš„æ˜¯ Optional[26]ï¼Œè¿˜éœ€è¦ get() å¾—åˆ° 26</span></span><br><span class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>).reduce(<span class="number">1000</span>, (acc, n) -&gt; acc + n); <span class="comment">// 1026 è®¾ç½®åˆå§‹å€¼å‚æ•°ï¼Œä¸éœ€è¦ get()</span></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥å®ç° String çš„ join æ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<h4 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h4><p>æ’åºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">sorted</span><span class="params">()</span> <span class="comment">// æŒ‰å…ƒç´ é»˜è®¤å¤§å°æ’åºï¼ˆå¿…é¡»å®ç° Comparable æ¥å£ï¼‰</span></span></span><br><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">sorted</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; cp)</span> <span class="comment">// æŒ‰æŒ‡å®š Comparator æ¯”è¾ƒçš„ç»“æœæ’åº</span></span></span><br></pre></td></tr></table></figure>
<p>å»é™¤é‡å¤å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">distinct</span><span class="params">()</span>  <span class="comment">// like what a set does</span></span></span><br></pre></td></tr></table></figure>
<p>æˆªå–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">limit</span><span class="params">(<span class="keyword">long</span>)</span> <span class="comment">// æˆªå–å½“å‰ Stream çš„æœ€å¤šå‰ Nä¸ªå…ƒç´ </span></span></span><br><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">skip</span><span class="params">(<span class="keyword">long</span>)</span>  <span class="comment">// è·³è¿‡å½“å‰ Stream çš„å‰ N ä¸ªå…ƒç´ </span></span></span><br></pre></td></tr></table></figure>
<p>åˆå¹¶ Streamï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; s = Stream.concat(</span><br><span class="line">    Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),</span><br><span class="line">    Stream.of(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

        
      </div>
      
      
      
    </div>
    
    
    
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/handsomecat.jpg" alt="Junhao Wang">
            
              <p class="site-author-name" itemprop="name">Junhao Wang</p>
              <p class="site-description motion-element" itemprop="description">Debug the old world, bug the new world!</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">114</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/chuckwangg" target="_blank" title="Facebook">
                      
                        <i class="fa fa-fw fa-facebook"></i>Facebook</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/junhaowww" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/junhaowww/" target="_blank" title="LinkedIn">
                      
                        <i class="fa fa-fw fa-linkedin"></i>LinkedIn</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.douban.com/people/maodai/" target="_blank" title="è±†ç“£ (Book)">
                      
                        <i class="fa fa-fw fa-book"></i>è±†ç“£ (Book)</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/41865efdad5d/" title="Xiaofud" target="_blank">Xiaofud</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.davex.pw/" title="DaveX" target="_blank">DaveX</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://alexfan.xyz/" title="alexfan.xyz" target="_blank">alexfan.xyz</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰"><span class="nav-number">1.</span> <span class="nav-text">å•å…ƒæµ‹è¯•ï¼ˆJUnitï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç®€ä»‹"><span class="nav-number">1.1.</span> <span class="nav-text">ç®€ä»‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç”Ÿå‘½å‘¨æœŸ"><span class="nav-number">1.2.</span> <span class="nav-text">ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¼‚å¸¸æµ‹è¯•"><span class="nav-number">1.3.</span> <span class="nav-text">å¼‚å¸¸æµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚æ•°åŒ–æµ‹è¯•"><span class="nav-number">1.4.</span> <span class="nav-text">å‚æ•°åŒ–æµ‹è¯•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¶…æ—¶æµ‹è¯•"><span class="nav-number">1.5.</span> <span class="nav-text">è¶…æ—¶æµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¤„ç†æ—¥æœŸå’Œæ—¶é—´"><span class="nav-number">2.</span> <span class="nav-text">å¤„ç†æ—¥æœŸå’Œæ—¶é—´</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¦‚å¿µ"><span class="nav-number">2.1.</span> <span class="nav-text">æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ—¶åˆ»ä¸æ—¶åŒº"><span class="nav-number">2.1.1.</span> <span class="nav-text">æ—¶åˆ»ä¸æ—¶åŒº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤ä»¤æ—¶"><span class="nav-number">2.1.2.</span> <span class="nav-text">å¤ä»¤æ—¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åœ°åŒº"><span class="nav-number">2.1.3.</span> <span class="nav-text">åœ°åŒº</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-util-çš„-API"><span class="nav-number">2.2.</span> <span class="nav-text">java.util çš„ API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Date"><span class="nav-number">2.2.1.</span> <span class="nav-text">Date</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Calendar"><span class="nav-number">2.2.2.</span> <span class="nav-text">Calendar</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-time-çš„-API"><span class="nav-number">2.3.</span> <span class="nav-text">java.time çš„ API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LocalDateTime"><span class="nav-number">2.3.1.</span> <span class="nav-text">LocalDateTime</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ZonedDateTime"><span class="nav-number">2.3.2.</span> <span class="nav-text">ZonedDateTime</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æœ€ä½³å®è·µ"><span class="nav-number">2.4.</span> <span class="nav-text">æœ€ä½³å®è·µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ­£åˆ™è¡¨è¾¾å¼"><span class="nav-number">3.</span> <span class="nav-text">æ­£åˆ™è¡¨è¾¾å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åŒ¹é…è§„åˆ™"><span class="nav-number">3.1.</span> <span class="nav-text">åŒ¹é…è§„åˆ™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿›é˜¶"><span class="nav-number">3.2.</span> <span class="nav-text">è¿›é˜¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤æ‚åŒ¹é…è§„åˆ™"><span class="nav-number">3.2.1.</span> <span class="nav-text">å¤æ‚åŒ¹é…è§„åˆ™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ†ç»„åŒ¹é…è§„åˆ™"><span class="nav-number">3.2.2.</span> <span class="nav-text">åˆ†ç»„åŒ¹é…è§„åˆ™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#éè´ªå©ªåŒ¹é…"><span class="nav-number">3.2.3.</span> <span class="nav-text">éè´ªå©ªåŒ¹é…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æœç´¢å’Œæ›¿æ¢"><span class="nav-number">3.2.4.</span> <span class="nav-text">æœç´¢å’Œæ›¿æ¢</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¤šçº¿ç¨‹ç¼–ç¨‹"><span class="nav-number">4.</span> <span class="nav-text">å¤šçº¿ç¨‹ç¼–ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#çº¿ç¨‹çš„æ¦‚å¿µ"><span class="nav-number">4.1.</span> <span class="nav-text">çº¿ç¨‹çš„æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤šçº¿ç¨‹ç®€ä»‹"><span class="nav-number">4.1.1.</span> <span class="nav-text">å¤šçº¿ç¨‹ç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ›å»ºæ–°çº¿ç¨‹"><span class="nav-number">4.1.2.</span> <span class="nav-text">åˆ›å»ºæ–°çº¿ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#çº¿ç¨‹çš„çŠ¶æ€"><span class="nav-number">4.1.3.</span> <span class="nav-text">çº¿ç¨‹çš„çŠ¶æ€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸­æ–­çº¿ç¨‹"><span class="nav-number">4.1.4.</span> <span class="nav-text">ä¸­æ–­çº¿ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®ˆæŠ¤çº¿ç¨‹"><span class="nav-number">4.1.5.</span> <span class="nav-text">å®ˆæŠ¤çº¿ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#çº¿ç¨‹åŒæ­¥"><span class="nav-number">4.2.</span> <span class="nav-text">çº¿ç¨‹åŒæ­¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#synchronized-æ–¹æ³•"><span class="nav-number">4.2.1.</span> <span class="nav-text">synchronized æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ­»é”"><span class="nav-number">4.2.2.</span> <span class="nav-text">æ­»é”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wait-å’Œ-notify"><span class="nav-number">4.2.3.</span> <span class="nav-text">wait å’Œ notify</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é«˜çº§-concurrent-åŒ…"><span class="nav-number">4.3.</span> <span class="nav-text">é«˜çº§ concurrent åŒ…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ReentrantLock"><span class="nav-number">4.3.1.</span> <span class="nav-text">ReentrantLock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadWriteLock"><span class="nav-number">4.3.2.</span> <span class="nav-text">ReadWriteLock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Condition"><span class="nav-number">4.3.3.</span> <span class="nav-text">Condition</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Concurrent-é›†åˆ"><span class="nav-number">4.3.4.</span> <span class="nav-text">Concurrent é›†åˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Atomic"><span class="nav-number">4.3.5.</span> <span class="nav-text">Atomic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ExecutorService"><span class="nav-number">4.3.6.</span> <span class="nav-text">ExecutorService</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Future"><span class="nav-number">4.3.7.</span> <span class="nav-text">Future</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CompletableFuture"><span class="nav-number">4.3.8.</span> <span class="nav-text">CompletableFuture</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fork-Join"><span class="nav-number">4.3.9.</span> <span class="nav-text">Fork / Join</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#çº¿ç¨‹å·¥å…·-ThreadLocal"><span class="nav-number">4.4.</span> <span class="nav-text">çº¿ç¨‹å·¥å…· ThreadLocal</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maven-åŸºç¡€"><span class="nav-number">5.</span> <span class="nav-text">Maven åŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å…¥é—¨"><span class="nav-number">5.1.</span> <span class="nav-text">å…¥é—¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç®€ä»‹-1"><span class="nav-number">5.1.1.</span> <span class="nav-text">ç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¾èµ–ç®¡ç†"><span class="nav-number">5.1.2.</span> <span class="nav-text">ä¾èµ–ç®¡ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ„å»ºæµç¨‹"><span class="nav-number">5.1.3.</span> <span class="nav-text">æ„å»ºæµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿›é˜¶-1"><span class="nav-number">5.2.</span> <span class="nav-text">è¿›é˜¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨æ’ä»¶"><span class="nav-number">5.2.1.</span> <span class="nav-text">ä½¿ç”¨æ’ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ¨¡å—ç®¡ç†"><span class="nav-number">5.2.2.</span> <span class="nav-text">æ¨¡å—ç®¡ç†</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC-åŸºç¡€"><span class="nav-number">6.</span> <span class="nav-text">JDBC åŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç®€ä»‹-2"><span class="nav-number">6.1.</span> <span class="nav-text">ç®€ä»‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æŸ¥è¯¢"><span class="nav-number">6.2.</span> <span class="nav-text">æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ›´æ–°-amp-æ’å…¥"><span class="nav-number">6.3.</span> <span class="nav-text">æ›´æ–° &amp; æ’å…¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#äº‹åŠ¡"><span class="nav-number">6.4.</span> <span class="nav-text">äº‹åŠ¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡½æ•°å¼ç¼–ç¨‹"><span class="nav-number">7.</span> <span class="nav-text">å‡½æ•°å¼ç¼–ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Lambda-åŸºç¡€"><span class="nav-number">7.1.</span> <span class="nav-text">Lambda åŸºç¡€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ–¹æ³•å¼•ç”¨ï¼ˆMethod-Referenceï¼‰"><span class="nav-number">7.2.</span> <span class="nav-text">æ–¹æ³•å¼•ç”¨ï¼ˆMethod Referenceï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stream"><span class="nav-number">7.3.</span> <span class="nav-text">Stream</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç®€ä»‹-3"><span class="nav-number">7.3.1.</span> <span class="nav-text">ç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ›å»º-Stream"><span class="nav-number">7.3.2.</span> <span class="nav-text">åˆ›å»º Stream</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#map"><span class="nav-number">7.3.3.</span> <span class="nav-text">map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filter"><span class="nav-number">7.3.4.</span> <span class="nav-text">filter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reduce"><span class="nav-number">7.3.5.</span> <span class="nav-text">reduce</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å…¶ä»–æ“ä½œ"><span class="nav-number">7.3.6.</span> <span class="nav-text">å…¶ä»–æ“ä½œ</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Junhao Wang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>








        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://junhaow.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://www.junhaow.com/studynotes/java/Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰.html';
          this.page.identifier = 'studynotes/java/Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰.html';
          this.page.title = 'Java åŸºç¡€å­¦ä¹ ç¬”è®°ï¼ˆä¸‹ï¼‰';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://junhaow.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  

  
  


  

  


</body>
</html>
